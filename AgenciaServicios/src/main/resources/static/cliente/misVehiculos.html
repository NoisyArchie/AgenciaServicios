<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8" />
    <title>Mis Vehículos - Siscare</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />
</head>

<body class="bg-[#0D0D0D] text-white min-h-screen flex">
    <!-- SIDEBAR -->
    <aside class="w-64 bg-black/80 border-r border-orange-600/20 flex flex-col justify-between py-6 px-4">
        <div>
            <h2 class="text-3xl font-bold text-orange-500 border-b border-gray-700 pb-2 mb-6 text-center">
                Siscare
            </h2>

            <nav class="flex flex-col gap-1">
                <a href="/cliente/home.html" 
                   class="flex items-center gap-3 p-3 rounded hover:bg-orange-500/20 transition">
                    <i class="bx bx-home text-xl"></i> Inicio
                </a>

                <a href="/cliente/misServicios.html" 
                   class="flex items-center gap-3 p-3 rounded hover:bg-orange-500/20 transition">
                    <i class="bx bx-wrench text-xl"></i> Mis Servicios
                </a>

                <a href="/cliente/misVehiculos.html" 
                   class="flex items-center gap-3 p-3 rounded bg-orange-500/20 transition">
                    <i class="bx bx-car text-xl text-orange-400"></i> Mis Vehículos
                </a>

                <a href="/cliente/miPerfil.html" 
                   class="flex items-center gap-3 p-3 rounded hover:bg-orange-500/20 transition">
                    <i class="bx bx-user text-xl"></i> Mi Perfil
                </a>
            </nav>
        </div>

        <div class="border-t border-gray-700 pt-4">
            <a href="#" class="flex items-center gap-3 p-3 hover:bg-red-500/30 rounded transition text-red-400">
                <i class="bx bx-log-out text-xl"></i> Cerrar Sesión
            </a>
        </div>
    </aside>

    <!-- CONTENIDO PRINCIPAL -->
    <main class="flex-1 flex flex-col">
        <!-- NAVBAR SUPERIOR -->
        <header class="flex justify-between items-center px-8 py-4 border-b border-gray-800 bg-[#111]/80 backdrop-blur-sm">
            <!-- Icono de usuario -->
            <div class="flex items-center gap-3">
                <span class="text-gray-300 text-sm" id="headerNombre">Juan Pérez García</span>
                <button class="bg-orange-600 hover:bg-orange-500 p-2 rounded-full transition">
                    <i class="bx bx-user text-white text-xl"></i>
                </button>
            </div>
        </header>

        <!-- CONTENIDO -->
        <section class="p-8 flex-1 overflow-y-auto">
            <div class="max-w-4xl mx-auto">
                <!-- Encabezado -->
                <div class="mb-8">
                    <h1 class="text-3xl font-bold">Mis Vehículos</h1>
                    <p class="text-gray-400 text-sm">
                        Gestiona la información de tus vehículos registrados
                    </p>
                </div>

                <!-- Selector de Vehículo -->
                <div class="bg-[#1A1A1A] p-6 rounded-xl border border-gray-700 mb-6">
                    <h2 class="text-xl font-bold text-orange-400 mb-4 flex items-center gap-2">
                        <i class="bx bx-car"></i>
                        Seleccionar Vehículo
                    </h2>
                    
                    <div class="flex gap-4 items-end">
                        <div class="flex-1">
                            <label class="block text-sm font-medium text-gray-300 mb-2">
                                Selecciona un vehículo para ver o editar su información
                            </label>
                            <select id="selectVehiculo"
                                class="w-full bg-black/30 border border-gray-700 text-white p-3 rounded-lg focus:border-orange-500 transition">
                                <option value="">Selecciona un vehículo...</option>
                                <!-- Las opciones se cargarán dinámicamente -->
                            </select>
                        </div>
                        <button onclick="cargarVehiculo()"
                            class="px-6 py-3 bg-orange-600 hover:bg-orange-500 rounded-lg transition flex items-center gap-2">
                            <i class="bx bx-show"></i>
                            Cargar Vehículo
                        </button>
                    </div>
                </div>

                <!-- Información del Vehículo Seleccionado -->
                <div id="contenedorVehiculo" class="hidden">
                    <div class="bg-[#1A1A1A] rounded-xl border border-gray-700 overflow-hidden">
                        <!-- Header con información básica -->
                        <div class="p-6 border-b border-gray-700 bg-gradient-to-r from-orange-500/10 to-transparent">
                            <div class="flex justify-between items-start">
                                <div>
                                    <h2 class="text-2xl font-bold" id="vehiculoTitulo">Toyota Corolla 2022</h2>
                                    <p class="text-gray-400" id="vehiculoSubtitulo">Número de Serie: ABC123456789</p>
                                </div>
                                <div class="text-right">
                                    <div class="text-sm text-gray-400">Próximo Servicio</div>
                                    <div class="text-lg font-bold text-orange-400" id="proximoServicio">15 Feb 2024</div>
                                </div>
                            </div>
                        </div>

                        <!-- Contenido en dos columnas -->
                        <div class="p-6">
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                <!-- Columna Izquierda: Información General (Solo lectura) -->
                                <div class="space-y-6">
                                    <div>
                                        <h3 class="text-lg font-bold text-orange-400 mb-4 flex items-center gap-2">
                                            <i class="bx bx-info-circle"></i>
                                            Información General
                                        </h3>
                                        
                                        <div class="space-y-4">
                                            <div class="bg-black/30 p-4 rounded-lg border border-gray-600">
                                                <label class="block text-sm font-medium text-gray-300 mb-2">
                                                    Marca y Modelo
                                                </label>
                                                <div class="w-full bg-black/20 border border-gray-700 text-gray-400 p-3 rounded-lg">
                                                    <span id="infoMarcaModelo">Toyota Corolla</span>
                                                </div>
                                            </div>

                                            <div class="bg-black/30 p-4 rounded-lg border border-gray-600">
                                                <label class="block text-sm font-medium text-gray-300 mb-2">
                                                    Año
                                                </label>
                                                <div class="w-full bg-black/20 border border-gray-700 text-gray-400 p-3 rounded-lg">
                                                    <span id="infoAnio">2022</span>
                                                </div>
                                            </div>

                                            <div class="bg-black/30 p-4 rounded-lg border border-gray-600">
                                                <label class="block text-sm font-medium text-gray-300 mb-2">
                                                    Número de Serie
                                                </label>
                                                <div class="w-full bg-black/20 border border-gray-700 text-gray-400 p-3 rounded-lg">
                                                    <span id="infoNumeroSerie">ABC123456789</span>
                                                </div>
                                                <p class="mt-1 text-xs text-gray-500">
                                                    No se puede modificar
                                                </p>
                                            </div>

                                            <div class="bg-black/30 p-4 rounded-lg border border-gray-600">
                                                <label class="block text-sm font-medium text-gray-300 mb-2">
                                                    Kilometraje Actual
                                                </label>
                                                <div class="w-full bg-black/20 border border-gray-700 text-gray-400 p-3 rounded-lg">
                                                    <span id="infoKilometraje">45,000 km</span>
                                                </div>
                                                <p class="mt-1 text-xs text-gray-500">
                                                    Se actualiza automáticamente en cada servicio
                                                </p>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Información de Próximo Servicio -->
                                    <div>
                                        <h3 class="text-lg font-bold text-orange-400 mb-4 flex items-center gap-2">
                                            <i class="bx bx-calendar-check"></i>
                                            Próximo Servicio
                                        </h3>
                                        
                                        <div class="bg-gradient-to-br from-green-500/10 to-emerald-500/5 border border-green-500/20 rounded-xl p-4">
                                            <div class="flex items-center gap-4">
                                                <div class="bg-green-500/20 p-3 rounded-lg">
                                                    <i class="bx bx-calendar text-green-400 text-2xl"></i>
                                                </div>
                                                <div>
                                                    <p class="text-gray-400 text-sm">Fecha Estimada</p>
                                                    <p class="text-xl font-bold text-white" id="infoFechaProximoServicio">15 de Febrero, 2024</p>
                                                    <p class="text-green-400 text-xs" id="infoKilometrajeProximoServicio">Próximo servicio a los 50,000 km</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Columna Derecha: Información Editable -->
                                <div class="space-y-6">
                                    <div>
                                        <h3 class="text-lg font-bold text-orange-400 mb-4 flex items-center gap-2">
                                            <i class="bx bx-edit"></i>
                                            Información Editable
                                        </h3>
                                        
                                        <form id="formVehiculo" class="space-y-4">
                                            <div class="bg-black/30 p-4 rounded-lg border border-gray-600">
                                                <label class="block text-sm font-medium text-gray-300 mb-2">
                                                    Placas *
                                                </label>
                                                <input type="text" id="inputPlacas" required
                                                    class="w-full bg-black/20 border border-gray-700 text-white p-3 rounded-lg focus:border-orange-500 transition"
                                                    placeholder="Ej: ABC-123">
                                                <p class="mt-1 text-xs text-gray-400">
                                                    Actualiza las placas de tu vehículo si han cambiado
                                                </p>
                                            </div>

                                            <div class="bg-black/30 p-4 rounded-lg border border-gray-600">
                                                <label class="block text-sm font-medium text-gray-300 mb-2">
                                                    Color *
                                                </label>
                                                <input type="text" id="inputColor" required
                                                    class="w-full bg-black/20 border border-gray-700 text-white p-3 rounded-lg focus:border-orange-500 transition"
                                                    placeholder="Ej: Rojo, Azul, Negro...">
                                                <p class="mt-1 text-xs text-gray-400">
                                                    Indica el color actual de tu vehículo
                                                </p>
                                            </div>

                                            <div class="flex justify-end gap-3 pt-4">
                                                <button type="button" onclick="cancelarEdicion()"
                                                    class="px-6 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg transition">
                                                    Cancelar
                                                </button>
                                                <button type="submit"
                                                    class="px-6 py-2 bg-orange-600 hover:bg-orange-500 rounded-lg transition flex items-center gap-2">
                                                    <i class="bx bx-save"></i>
                                                    Guardar Cambios
                                                </button>
                                            </div>
                                        </form>
                                    </div>

                                    <!-- Historial Reciente -->
                                    <div>
                                        <h3 class="text-lg font-bold text-orange-400 mb-4 flex items-center gap-2">
                                            <i class="bx bx-history"></i>
                                            Último Servicio
                                        </h3>
                                        
                                        <div class="bg-black/30 p-4 rounded-lg border border-gray-600">
                                            <div class="space-y-3">
                                                <div class="flex justify-between items-center">
                                                    <span class="text-gray-400">Fecha:</span>
                                                    <span class="font-medium" id="ultimoServicioFecha">15 Ene 2024</span>
                                                </div>
                                                <div class="flex justify-between items-center">
                                                    <span class="text-gray-400">Tipo:</span>
                                                    <span class="font-medium" id="ultimoServicioTipo">Mantenimiento General</span>
                                                </div>
                                                <div class="flex justify-between items-center">
                                                    <span class="text-gray-400">Kilometraje:</span>
                                                    <span class="font-medium" id="ultimoServicioKm">45,000 km</span>
                                                </div>
                                                <div class="flex justify-between items-center">
                                                    <span class="text-gray-400">Estatus:</span>
                                                    <span class="px-2 py-1 bg-green-500/20 text-green-400 rounded text-xs font-medium">Completado</span>
                                                </div>
                                            </div>
                                            <div class="mt-3 pt-3 border-t border-gray-600">
                                                <a href="/cliente/misServicios.html" 
                                                   class="text-orange-400 hover:text-orange-300 text-sm flex items-center gap-1">
                                                    <i class="bx bx-link-external"></i>
                                                    Ver historial completo de servicios
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Mensaje cuando no hay vehículo seleccionado -->
                <div id="mensajeSinVehiculo" class="bg-[#1A1A1A] p-12 rounded-xl border border-gray-700 text-center">
                    <div class="w-20 h-20 mx-auto bg-gray-700/50 rounded-full flex items-center justify-center mb-4">
                        <i class="bx bx-car text-gray-400 text-3xl"></i>
                    </div>
                    <h3 class="text-xl font-bold text-gray-300 mb-2">Selecciona un vehículo</h3>
                    <p class="text-gray-400 mb-6">Elige un vehículo de la lista para ver y editar su información</p>
                </div>
            </div>
        </section>
    </main>

    <!-- Modal de Confirmación -->
    <div id="modalConfirmacion" class="fixed inset-0 bg-black/70 backdrop-blur-md hidden justify-center items-center z-50">
        <div class="bg-[#1A1A1A]/95 p-8 rounded-2xl shadow-xl border border-orange-500/30 w-[500px] animate-[zoomIn_.3s_ease]">
            <div class="text-center">
                <div class="w-16 h-16 bg-green-500/20 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="bx bx-check text-green-400 text-2xl"></i>
                </div>
                <h3 class="text-xl font-bold text-white mb-2" id="modalTitulo">¡Cambios Guardados!</h3>
                <p class="text-gray-400 mb-6" id="modalMensaje">La información del vehículo se ha actualizado correctamente.</p>
                
                <button onclick="cerrarModalConfirmacion()" 
                        class="px-8 py-3 bg-orange-600 hover:bg-orange-500 rounded-lg transition">
                    Aceptar
                </button>
            </div>
        </div>
    </div>

    <style>
        @keyframes zoomIn {
            0% {
                opacity: 0;
                transform: scale(0.85);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            box-shadow: 0 0 0 2px rgba(255, 140, 0, 0.2);
        }
    </style>

    <script>
        // Datos de ejemplo (en producción vendrían de una API)
        const vehiculosData = [
            {
                id_vehiculo: 1,
                marca: "Toyota",
                modelo: "Corolla",
                anio: 2022,
                numero_serie: "ABC123456789",
                placas: "ABC-123",
                color: "Rojo",
                kilometraje: 45000,
                fecha_registro: "2022-03-15",
                proximo_servicio: {
                    fecha: "2024-02-15",
                    kilometraje: 50000,
                    tipo: "Mantenimiento preventivo"
                },
                ultimo_servicio: {
                    fecha: "2024-01-15",
                    tipo: "Mantenimiento General",
                    kilometraje: 45000,
                    estatus: "completado"
                }
            },
            {
                id_vehiculo: 2,
                marca: "Honda",
                modelo: "Civic",
                anio: 2020,
                numero_serie: "XYZ987654321",
                placas: "XYZ-789",
                color: "Azul",
                kilometraje: 32000,
                fecha_registro: "2020-07-22",
                proximo_servicio: {
                    fecha: "2024-03-10",
                    kilometraje: 35000,
                    tipo: "Cambio de aceite"
                },
                ultimo_servicio: {
                    fecha: "2024-01-20",
                    tipo: "Reparación de frenos",
                    kilometraje: 32000,
                    estatus: "completado"
                }
            },
            {
                id_vehiculo: 3,
                marca: "Nissan",
                modelo: "Sentra",
                anio: 2023,
                numero_serie: "DEF456789123",
                placas: "DEF-456",
                color: "Blanco",
                kilometraje: 8000,
                fecha_registro: "2023-11-10",
                proximo_servicio: {
                    fecha: "2024-04-01",
                    kilometraje: 10000,
                    tipo: "Primer servicio"
                },
                ultimo_servicio: null // Sin servicios aún
            }
        ];

        let vehiculoActual = null;
        let datosOriginales = {};

        // Inicializar la página
        document.addEventListener('DOMContentLoaded', function() {
            cargarListaVehiculos();
            configurarEventos();
        });

        // Configurar eventos
        function configurarEventos() {
            // Formulario de vehículo
            document.getElementById('formVehiculo').addEventListener('submit', function(e) {
                e.preventDefault();
                guardarCambiosVehiculo();
            });

            // Enter en el select para cargar vehículo
            document.getElementById('selectVehiculo').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    cargarVehiculo();
                }
            });
        }

        // Cargar lista de vehículos en el select
        function cargarListaVehiculos() {
            const select = document.getElementById('selectVehiculo');
            
            vehiculosData.forEach(vehiculo => {
                const option = document.createElement('option');
                option.value = vehiculo.id_vehiculo;
                option.textContent = `${vehiculo.marca} ${vehiculo.modelo} ${vehiculo.anio} - ${vehiculo.placas}`;
                select.appendChild(option);
            });
        }

        // Cargar vehículo seleccionado
        function cargarVehiculo() {
            const select = document.getElementById('selectVehiculo');
            const idVehiculo = select.value;

            if (!idVehiculo) {
                mostrarMensajeSinVehiculo();
                return;
            }

            vehiculoActual = vehiculosData.find(v => v.id_vehiculo == idVehiculo);
            if (!vehiculoActual) return;

            // Guardar datos originales para cancelar edición
            datosOriginales = {
                placas: vehiculoActual.placas,
                color: vehiculoActual.color
            };

            // Mostrar contenedor y ocultar mensaje
            document.getElementById('contenedorVehiculo').classList.remove('hidden');
            document.getElementById('mensajeSinVehiculo').classList.add('hidden');

            // Actualizar información en la UI
            actualizarUI();
        }

        // Mostrar mensaje cuando no hay vehículo seleccionado
        function mostrarMensajeSinVehiculo() {
            document.getElementById('contenedorVehiculo').classList.add('hidden');
            document.getElementById('mensajeSinVehiculo').classList.remove('hidden');
        }

        // Actualizar la interfaz con los datos del vehículo
        function actualizarUI() {
            if (!vehiculoActual) return;

            // Información básica
            document.getElementById('vehiculoTitulo').textContent = 
                `${vehiculoActual.marca} ${vehiculoActual.modelo} ${vehiculoActual.anio}`;
            document.getElementById('vehiculoSubtitulo').textContent = 
                `Número de Serie: ${vehiculoActual.numero_serie}`;

            // Próximo servicio
            const proximoServicio = vehiculoActual.proximo_servicio;
            if (proximoServicio) {
                const fecha = new Date(proximoServicio.fecha).toLocaleDateString('es-MX', {
                    day: 'numeric',
                    month: 'short',
                    year: 'numeric'
                });
                document.getElementById('proximoServicio').textContent = fecha;
                document.getElementById('infoFechaProximoServicio').textContent = fecha;
                document.getElementById('infoKilometrajeProximoServicio').textContent = 
                    `Próximo servicio a los ${proximoServicio.kilometraje.toLocaleString()} km`;
            }

            // Información general (solo lectura)
            document.getElementById('infoMarcaModelo').textContent = 
                `${vehiculoActual.marca} ${vehiculoActual.modelo}`;
            document.getElementById('infoAnio').textContent = vehiculoActual.anio;
            document.getElementById('infoNumeroSerie').textContent = vehiculoActual.numero_serie;
            document.getElementById('infoKilometraje').textContent = 
                `${vehiculoActual.kilometraje.toLocaleString()} km`;

            // Información editable
            document.getElementById('inputPlacas').value = vehiculoActual.placas;
            document.getElementById('inputColor').value = vehiculoActual.color;

            // Último servicio
            const ultimoServicio = vehiculoActual.ultimo_servicio;
            if (ultimoServicio) {
                const fecha = new Date(ultimoServicio.fecha).toLocaleDateString('es-MX', {
                    day: 'numeric',
                    month: 'short',
                    year: 'numeric'
                });
                document.getElementById('ultimoServicioFecha').textContent = fecha;
                document.getElementById('ultimoServicioTipo').textContent = ultimoServicio.tipo;
                document.getElementById('ultimoServicioKm').textContent = 
                    `${ultimoServicio.kilometraje.toLocaleString()} km`;
            } else {
                document.getElementById('ultimoServicioFecha').textContent = 'N/A';
                document.getElementById('ultimoServicioTipo').textContent = 'Sin servicios';
                document.getElementById('ultimoServicioKm').textContent = 'N/A';
            }
        }

        // Guardar cambios del vehículo
        function guardarCambiosVehiculo() {
            if (!vehiculoActual) return;

            const nuevasPlacas = document.getElementById('inputPlacas').value.trim();
            const nuevoColor = document.getElementById('inputColor').value.trim();

            if (!nuevasPlacas || !nuevoColor) {
                mostrarModal('Error', 'Por favor completa todos los campos requeridos');
                return;
            }

            // Simular guardado (en producción sería una llamada API)
            vehiculoActual.placas = nuevasPlacas;
            vehiculoActual.color = nuevoColor;

            // Actualizar datos originales
            datosOriginales.placas = nuevasPlacas;
            datosOriginales.color = nuevoColor;

            // Actualizar el texto en el select
            const select = document.getElementById('selectVehiculo');
            const option = select.options[select.selectedIndex];
            option.textContent = `${vehiculoActual.marca} ${vehiculoActual.modelo} ${vehiculoActual.anio} - ${nuevasPlacas}`;

            mostrarModal('¡Éxito!', 'La información del vehículo se ha actualizado correctamente');
        }

        // Cancelar edición
        function cancelarEdicion() {
            if (!vehiculoActual) return;

            // Restaurar valores originales
            document.getElementById('inputPlacas').value = datosOriginales.placas;
            document.getElementById('inputColor').value = datosOriginales.color;
        }

        // Mostrar modal
        function mostrarModal(titulo, mensaje) {
            document.getElementById('modalTitulo').textContent = titulo;
            document.getElementById('modalMensaje').textContent = mensaje;
            document.getElementById('modalConfirmacion').classList.remove('hidden');
        }

        // Cerrar modal
        function cerrarModalConfirmacion() {
            document.getElementById('modalConfirmacion').classList.add('hidden');
        }

        // Cerrar modal con ESC
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                cerrarModalConfirmacion();
            }
        });
    </script>
</body>

</html>