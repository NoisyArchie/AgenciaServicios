<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8" />
    <title>Alta de Usuarios - Siscare</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />
</head>

<body class="bg-[#0D0D0D] text-white min-h-screen flex">
    <!-- SIDEBAR -->
    <aside class="w-64 bg-black/80 border-r border-orange-600/20 flex flex-col justify-between py-6 px-4">
        <div>
            <h2 class="text-3xl font-bold text-orange-500 border-b border-gray-700 pb-2 mb-6 text-center">
                Siscare
            </h2>

            <nav class="flex flex-col gap-1">
                <a href="/admin/panelAdmin.html" class="flex items-center gap-3 p-3 rounded hover:bg-orange-500/20 transition">
                    <i class="bx bx-home text-xl"></i> Panel
                </a>

                <a href="/admin/servicios.html" class="flex items-center gap-3 p-3 rounded hover:bg-orange-500/20 transition">
                    <i class="bx bx-wrench text-xl"></i> Servicios
                </a>

                <a href="/admin/usuarios.html" class="flex items-center gap-3 p-3 rounded hover:bg-orange-500/20 transition">
                    <i class="bx bx-id-card text-xl"></i> Usuarios
                </a>

                <!-- Sección de Catálogos -->
                <div>
                    <button id="btnCatalogos"
                        class="flex justify-between items-center w-full p-3 hover:bg-orange-500/20 rounded transition">
                        <span class="flex items-center gap-3"><i class="bx bx-folder text-xl"></i> Catálogos</span>
                        <i id="iconArrow" class="bx bx-chevron-down text-xl"></i>
                    </button>

                    <div id="submenuCatalogos" class="pl-10 mt-1 flex flex-col hidden">
                        <a href="/admin/catalogoTiposServicio.html"
                            class="block py-2 text-sm hover:text-orange-400">Tipos de Servicio</a>
                        <a href="/admin/catalogoRefacciones.html"
                            class="block py-2 text-sm hover:text-orange-400">Refacciones</a>
                        <a href="/admin/catalogoMarcas.html" class="block py-2 text-sm hover:text-orange-400">Marcas</a>
                        <a href="/admin/catalogoModelos.html"
                            class="block py-2 text-sm hover:text-orange-400">Modelos</a>
                    </div>
                </div>
            </nav>
        </div>

        <div class="border-t border-gray-700 pt-4">
            <a href="#" class="flex items-center gap-3 p-3 hover:bg-red-500/30 rounded transition text-red-400">
                <i class="bx bx-log-out text-xl"></i> Cerrar Sesión
            </a>
        </div>
    </aside>

    <!-- CONTENIDO PRINCIPAL -->
    <main class="flex-1 flex flex-col">
        <!-- NAVBAR SUPERIOR -->
        <header class="flex justify-between items-center px-8 py-4 border-b border-gray-800 bg-[#111]/80 backdrop-blur-sm">
            <!-- Icono de usuario -->
            <div class="flex items-center gap-3">
                <span class="text-gray-300 text-sm">Administrador</span>
                <button class="bg-orange-600 hover:bg-orange-500 p-2 rounded-full transition">
                    <i class="bx bx-user text-white text-xl"></i>
                </button>
            </div>
        </header>

        <!-- CONTENIDO -->
        <section class="p-8 flex-1 overflow-y-auto">
            <div class="max-w-2xl mx-auto">
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h1 class="text-3xl font-bold">Alta de Usuarios</h1>
                        <p class="text-gray-400 text-sm">
                            Registra nuevos usuarios en el sistema
                        </p>
                    </div>

                    <a href="/admin/usuarios.html"
                        class="flex items-center gap-2 bg-gray-700 hover:bg-gray-600 transition px-4 py-2 rounded shadow">
                        <i class="bx bx-arrow-back"></i> Volver a Usuarios
                    </a>
                </div>

                <!-- Formulario de Alta -->
                <div class="bg-[#1A1A1A] p-6 rounded-xl border border-gray-700">
                    <form id="formAltaUsuario" class="space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Columna Izquierda -->
                            <div class="space-y-6">
                                <div>
                                    <label for="username" class="block text-sm font-medium text-gray-300 mb-2">
                                        Nombre de Usuario *
                                    </label>
                                    <input
                                        type="text"
                                        id="username"
                                        name="username"
                                        required
                                        class="w-full bg-black/30 border border-gray-700 text-white p-3 rounded-lg focus:border-orange-500 focus:ring-1 focus:ring-orange-500 transition"
                                        placeholder="Ingresa el nombre de usuario"
                                    >
                                    <p class="mt-1 text-xs text-gray-400">Este será el nombre para iniciar sesión</p>
                                </div>

                                <div>
                                    <label for="password" class="block text-sm font-medium text-gray-300 mb-2">
                                        Contraseña *
                                    </label>
                                    <input
                                        type="password"
                                        id="password"
                                        name="password"
                                        required
                                        class="w-full bg-black/30 border border-gray-700 text-white p-3 rounded-lg focus:border-orange-500 focus:ring-1 focus:ring-orange-500 transition"
                                        placeholder="Ingresa la contraseña"
                                    >
                                    <p class="mt-1 text-xs text-gray-400">Mínimo 8 caracteres</p>
                                </div>

                                <div>
                                    <label for="confirmPassword" class="block text-sm font-medium text-gray-300 mb-2">
                                        Confirmar Contraseña *
                                    </label>
                                    <input
                                        type="password"
                                        id="confirmPassword"
                                        name="confirmPassword"
                                        required
                                        class="w-full bg-black/30 border border-gray-700 text-white p-3 rounded-lg focus:border-orange-500 focus:ring-1 focus:ring-orange-500 transition"
                                        placeholder="Confirma la contraseña"
                                    >
                                </div>
                            </div>

                            <!-- Columna Derecha -->
                            <div class="space-y-6">
                                <div>
                                    <label for="nombre_completo" class="block text-sm font-medium text-gray-300 mb-2">
                                        Nombre Completo *
                                    </label>
                                    <input
                                        type="text"
                                        id="nombre_completo"
                                        name="nombre_completo"
                                        required
                                        class="w-full bg-black/30 border border-gray-700 text-white p-3 rounded-lg focus:border-orange-500 focus:ring-1 focus:ring-orange-500 transition"
                                        placeholder="Nombre completo del usuario"
                                    >
                                </div>

                                <div>
                                    <label for="email" class="block text-sm font-medium text-gray-300 mb-2">
                                        Correo Electrónico *
                                    </label>
                                    <input
                                        type="email"
                                        id="email"
                                        name="email"
                                        required
                                        class="w-full bg-black/30 border border-gray-700 text-white p-3 rounded-lg focus:border-orange-500 focus:ring-1 focus:ring-orange-500 transition"
                                        placeholder="correo@ejemplo.com"
                                    >
                                </div>

                                <div>
                                    <label for="rol" class="block text-sm font-medium text-gray-300 mb-2">
                                        Rol del Usuario *
                                    </label>
                                    <select
                                        id="rol"
                                        name="rol"
                                        required
                                        class="w-full bg-black/30 border border-gray-700 text-white p-3 rounded-lg focus:border-orange-500 focus:ring-1 focus:ring-orange-500 transition"
                                    >
                                        <option value="">Selecciona un rol</option>
                                        <option value="admin">Administrador</option>
                                        <option value="trabajador">Trabajador</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Checkbox Activo -->
                        <div class="flex items-center gap-3 pt-4 border-t border-gray-700">
                            <input
                                type="checkbox"
                                id="activo"
                                name="activo"
                                checked
                                class="w-4 h-4 accent-orange-500 bg-black/30 border-gray-700 rounded focus:ring-orange-500"
                            >
                            <label for="activo" class="text-sm font-medium text-gray-300">
                                Usuario activo (puede iniciar sesión en el sistema)
                            </label>
                        </div>

                        <!-- Botones de acción -->
                        <div class="flex justify-end gap-4 pt-6 border-t border-gray-700">
                            <a href="/admin/usuarios.html"
                               class="px-6 py-3 bg-gray-700 hover:bg-gray-600 rounded-lg font-medium transition">
                                Cancelar
                            </a>
                            <button
                                type="submit"
                                class="px-6 py-3 bg-orange-600 hover:bg-orange-500 rounded-lg font-medium transition flex items-center gap-2">
                                <i class="bx bx-save"></i>
                                Guardar Usuario
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Información adicional -->
                <div class="mt-6 bg-[#1A1A1A] p-4 rounded-xl border border-gray-700">
                    <h3 class="text-lg font-semibold text-orange-400 mb-3">Información sobre los roles:</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                        <div class="p-3 bg-red-500/10 border border-red-500/20 rounded-lg">
                            <h4 class="font-medium text-red-400 mb-1">Administrador</h4>
                            <p class="text-gray-400">Acceso completo al sistema, puede gestionar todos los módulos y usuarios.</p>
                        </div>
                        <div class="p-3 bg-blue-500/10 border border-blue-500/20 rounded-lg">
                            <h4 class="font-medium text-blue-400 mb-1">Trabajador</h4>
                            <p class="text-gray-400">Puede gestionar servicios, refacciones y atender clientes.</p>
                        </div>
                        <div class="p-3 bg-green-500/10 border border-green-500/20 rounded-lg">
                            <h4 class="font-medium text-green-400 mb-1">Cliente</h4>
                            <p class="text-gray-400">Acceso limitado para consultar servicios y realizar solicitudes.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Modal de Confirmación -->
    <div id="modalConfirmacion" class="fixed inset-0 bg-black/70 backdrop-blur-md hidden justify-center items-center z-50">
        <div class="bg-[#1A1A1A]/95 p-8 rounded-2xl shadow-xl border border-orange-500/30 w-[400px] animate-[zoomIn_.3s_ease]">
            <div class="text-center">
                <div class="w-16 h-16 bg-green-500/20 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="bx bx-check text-green-400 text-2xl"></i>
                </div>
                <h3 class="text-xl font-bold text-white mb-2">¡Usuario Creado!</h3>
                <p class="text-gray-400 mb-6">El usuario ha sido registrado exitosamente en el sistema.</p>
                <div class="flex gap-3 justify-center">
                    <button onclick="cerrarModalConfirmacion()"
                            class="px-6 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg transition">
                        Crear Otro Usuario
                    </button>
                    <a href="/admin/usuarios.html"
                       class="px-6 py-2 bg-orange-600 hover:bg-orange-500 rounded-lg transition">
                        Ver Lista de Usuarios
                    </a>
                </div>
            </div>
        </div>
    </div>

    <style>
        @keyframes zoomIn {
            0% {
                opacity: 0;
                transform: scale(0.85);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        input:focus, select:focus {
            outline: none;
            box-shadow: 0 0 0 2px rgba(255, 140, 0, 0.2);
        }
    </style>

    <script>
        const API_URL = 'http://localhost:8080/api/usuarios';

        // Submenú de Catálogos
        const btnCatalogos = document.getElementById("btnCatalogos");
        const submenu = document.getElementById("submenuCatalogos");
        const iconArrow = document.getElementById("iconArrow");

        if (btnCatalogos && submenu && iconArrow) {
            btnCatalogos.addEventListener("click", () => {
                submenu.classList.toggle("hidden");
                iconArrow.classList.toggle("bx-chevron-down");
                iconArrow.classList.toggle("bx-chevron-up");
            });
        }

        // Validación y envío del formulario
        document.getElementById('formAltaUsuario').addEventListener('submit', async function(e) {
            e.preventDefault();

            // Validar contraseñas
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            if (password !== confirmPassword) {
                alert('Las contraseñas no coinciden');
                return;
            }

            if (password.length < 8) {
                alert('La contraseña debe tener al menos 8 caracteres');
                return;
            }

            // Validar que todos los campos requeridos estén llenos
            const requiredFields = ['username', 'nombre_completo', 'email', 'rol'];
            for (let field of requiredFields) {
                if (!document.getElementById(field).value) {
                    alert('Por favor, completa todos los campos requeridos');
                    return;
                }
            }

            // Crear objeto usuario
            const usuario = {
                username: document.getElementById('username').value,
                password: password,
                nombreCompleto: document.getElementById('nombre_completo').value,
                email: document.getElementById('email').value,
                rol: document.getElementById('rol').value,
                activo: document.getElementById('activo').checked
            };

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(usuario)
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Error al crear usuario');
                }

                // Mostrar modal de confirmación
                document.getElementById('modalConfirmacion').classList.remove('hidden');
                document.getElementById('modalConfirmacion').classList.add('flex');
            } catch (error) {
                console.error('Error:', error);
                alert('Error al crear usuario: ' + error.message);
            }
        });

        function cerrarModalConfirmacion() {
            document.getElementById('modalConfirmacion').classList.add('hidden');
            document.getElementById('modalConfirmacion').classList.remove('flex');
            // Limpiar formulario
            document.getElementById('formAltaUsuario').reset();
        }

        // Validación en tiempo real para contraseñas
        document.getElementById('confirmPassword').addEventListener('input', function() {
            const password = document.getElementById('password').value;
            const confirmPassword = this.value;

            if (confirmPassword && password !== confirmPassword) {
                this.classList.add('border-red-500');
                this.classList.remove('border-gray-700');
            } else {
                this.classList.remove('border-red-500');
                this.classList.add('border-gray-700');
            }
        });
    </script>
</body>

</html>