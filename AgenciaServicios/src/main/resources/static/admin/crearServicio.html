<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8" />
    <title>Crear Servicio - Siscare</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />
</head>

<body class="bg-[#0D0D0D] text-white min-h-screen flex">
    <!-- SIDEBAR -->
    <aside class="w-64 bg-black/80 border-r border-orange-600/20 flex flex-col justify-between py-6 px-4">
        <div>
            <h2 class="text-3xl font-bold text-orange-500 border-b border-gray-700 pb-2 mb-6 text-center">
                Siscare
            </h2>

            <nav class="flex flex-col gap-1">
                <a href="/admin/panelAdmin.html" class="flex items-center gap-3 p-3 rounded hover:bg-orange-500/20 transition">
                    <i class="bx bx-home text-xl"></i> Panel
                </a>

                <a href="/admin/servicios.html" class="flex items-center gap-3 p-3 rounded hover:bg-orange-500/20 transition">
                    <i class="bx bx-wrench text-xl"></i> Servicios
                </a>

                <a href="/admin/usuarios.html" class="flex items-center gap-3 p-3 rounded hover:bg-orange-500/20 transition">
                    <i class="bx bx-id-card text-xl"></i> Usuarios
                </a>

                <!-- Sección de Catálogos -->
                <div>
                    <button id="btnCatalogos"
                        class="flex justify-between items-center w-full p-3 hover:bg-orange-500/20 rounded transition">
                        <span class="flex items-center gap-3"><i class="bx bx-folder text-xl"></i> Catálogos</span>
                        <i id="iconArrow" class="bx bx-chevron-down text-xl"></i>
                    </button>

                    <div id="submenuCatalogos" class="pl-10 mt-1 flex flex-col hidden">
                        <a href="/admin/catalogoTiposServicio.html"
                            class="block py-2 text-sm hover:text-orange-400">Tipos de Servicio</a>
                        <a href="/admin/catalogoRefacciones.html"
                            class="block py-2 text-sm hover:text-orange-400">Refacciones</a>
                        <a href="/admin/catalogoMarcas.html" class="block py-2 text-sm hover:text-orange-400">Marcas</a>
                        <a href="/admin/catalogoModelos.html"
                            class="block py-2 text-sm hover:text-orange-400">Modelos</a>
                    </div>
                </div>
            </nav>
        </div>

        <div class="border-t border-gray-700 pt-4">
            <a href="#" class="flex items-center gap-3 p-3 hover:bg-red-500/30 rounded transition text-red-400">
                <i class="bx bx-log-out text-xl"></i> Cerrar Sesión
            </a>
        </div>
    </aside>

    <!-- CONTENIDO PRINCIPAL -->
    <main class="flex-1 flex flex-col">
        <!-- NAVBAR SUPERIOR -->
        <header class="flex justify-between items-center px-8 py-4 border-b border-gray-800 bg-[#111]/80 backdrop-blur-sm">
            <!-- Icono de usuario -->
            <div class="flex items-center gap-3">
                <span class="text-gray-300 text-sm">Administrador</span>
                <button class="bg-orange-600 hover:bg-orange-500 p-2 rounded-full transition">
                    <i class="bx bx-user text-white text-xl"></i>
                </button>
            </div>
        </header>

        <!-- CONTENIDO -->
        <section class="p-8 flex-1 overflow-y-auto">
            <div class="max-w-6xl mx-auto">
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h1 class="text-3xl font-bold">Crear Nuevo Servicio</h1>
                        <p class="text-gray-400 text-sm">
                            Registra un nuevo servicio en el sistema
                        </p>
                    </div>

                    <a href="/admin/servicios.html"
                        class="flex items-center gap-2 bg-gray-700 hover:bg-gray-600 transition px-4 py-2 rounded shadow">
                        <i class="bx bx-arrow-back"></i> Volver a Servicios
                    </a>
                </div>

                <!-- Formulario de Servicio -->
                <form id="formCrearServicio" class="space-y-8">
                    <!-- Sección 1: Información del Vehículo y Cliente -->
                    <div class="bg-[#1A1A1A] p-6 rounded-xl border border-gray-700">
                        <h2 class="text-xl font-bold text-orange-400 mb-4 flex items-center gap-2">
                            <i class="bx bx-car"></i>
                            Información del Vehículo y Cliente
                        </h2>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Columna Izquierda - Vehículo -->
                            <div class="space-y-4">
                                <h3 class="text-lg font-semibold text-gray-300 mb-3">Datos del Vehículo</h3>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">
                                        Seleccionar Vehículo Existente
                                    </label>
                                    <select id="selectVehiculo" class="w-full bg-black/30 border border-gray-700 text-white p-3 rounded-lg focus:border-orange-500">
                                        <option value="">Buscar vehículo por placas, cliente o modelo...</option>
                                        <option value="1" data-kilometraje="45000">ABC-1234 - Toyota Corolla 2022 - Juan Pérez (45,000 km)</option>
                                        <option value="2" data-kilometraje="32500">DEF-5678 - Honda Civic 2023 - María López (32,500 km)</option>
                                        <option value="3" data-kilometraje="68200">GHI-9012 - Nissan Sentra 2021 - Carlos Rodríguez (68,200 km)</option>
                                        <option value="4" data-kilometraje="89100">JKL-3456 - Ford Focus 2020 - Ana Martínez (89,100 km)</option>
                                        <option value="5" data-kilometraje="23400">MNO-7890 - Chevrolet Aveo 2023 - Roberto Sánchez (23,400 km)</option>
                                    </select>
                                </div>

                                <div class="text-center text-gray-400 text-sm">O</div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">
                                        Registrar Vehículo Nuevo
                                    </label>
                                    <button type="button" onclick="abrirModalVehiculo()" class="w-full bg-gray-700 hover:bg-gray-600 transition p-3 rounded-lg border border-dashed border-gray-600">
                                        <i class="bx bx-plus"></i> Agregar Vehículo Nuevo
                                    </button>
                                </div>

                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-300 mb-2">
                                            Kilometraje Actual *
                                        </label>
                                        <input type="number" id="inputKilometraje" required
                                            class="w-full bg-black/30 border border-gray-700 text-white p-3 rounded-lg focus:border-orange-500"
                                            placeholder="Ej: 45000">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-300 mb-2">
                                            Color
                                        </label>
                                        <input type="text" id="inputColor"
                                            class="w-full bg-black/30 border border-gray-700 text-white p-3 rounded-lg focus:border-orange-500"
                                            placeholder="Color del vehículo">
                                    </div>
                                </div>

                                <!-- Checkbox para persona que lleva el vehículo -->
                                <div class="mt-4 pt-4 border-t border-gray-700">
                                    <label class="flex items-center gap-3 mb-3">
                                        <input type="checkbox" id="checkLlevadoPorOtro" 
                                            class="accent-orange-500 w-4 h-4"
                                            onchange="togglePersonaEntrega()">
                                        <span class="text-sm font-medium text-gray-300">Llevado por otra persona</span>
                                    </label>

                                    <div id="personaEntregaFields" class="hidden space-y-3">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-300 mb-2">
                                                Nombre de quien entrega *
                                            </label>
                                            <input type="text" id="inputQuienEntrego"
                                                class="w-full bg-black/30 border border-gray-700 text-white p-3 rounded-lg focus:border-orange-500"
                                                placeholder="Nombre completo">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-300 mb-2">
                                                Teléfono de contacto *
                                            </label>
                                            <input type="tel" id="inputTelefonoQuienEntrego"
                                                class="w-full bg-black/30 border border-gray-700 text-white p-3 rounded-lg focus:border-orange-500"
                                                placeholder="Número de teléfono">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Columna Derecha - Información Mostrada -->
                            <div class="bg-black/30 p-4 rounded-lg border border-gray-600">
                                <h3 class="text-lg font-semibold text-orange-400 mb-3">Información del Vehículo Seleccionado</h3>
                                <div id="infoVehiculo" class="space-y-2 text-sm text-gray-300">
                                    <p class="text-center py-8">Selecciona un vehículo para ver su información</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sección 2: Detalles del Servicio -->
                    <div class="bg-[#1A1A1A] p-6 rounded-xl border border-gray-700">
                        <h2 class="text-xl font-bold text-orange-400 mb-4 flex items-center gap-2">
                            <i class="bx bx-wrench"></i>
                            Detalles del Servicio
                        </h2>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">
                                    Tipo de Mantenimiento *
                                </label>
                                <select id="selectTipoMantenimiento" required
                                    class="w-full bg-black/30 border border-gray-700 text-white p-3 rounded-lg focus:border-orange-500">
                                    <option value="">Selecciona el tipo de mantenimiento</option>
                                    <option value="preventivo">Preventivo</option>
                                    <option value="correctivo">Correctivo</option>
                                    <option value="mayor">Mantenimiento Mayor</option>
                                    <option value="diagnostico">Diagnóstico</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">
                                    Fecha Estimada de Entrega *
                                </label>
                                <input type="date" id="inputFechaEstimada" required
                                    class="w-full bg-black/30 border border-gray-700 text-white p-3 rounded-lg focus:border-orange-500">
                            </div>
                        </div>

                        <div class="mt-4">
                            <label class="block text-sm font-medium text-gray-300 mb-2">
                                Observaciones
                            </label>
                            <textarea id="textareaObservaciones" rows="3"
                                class="w-full bg-black/30 border border-gray-700 text-white p-3 rounded-lg focus:border-orange-500 resize-none"
                                placeholder="Observaciones adicionales sobre el servicio..."></textarea>
                        </div>
                    </div>

                    <!-- Sección 3: Servicios a Realizar -->
                    <div class="bg-[#1A1A1A] p-6 rounded-xl border border-gray-700">
                        <h2 class="text-xl font-bold text-orange-400 mb-4 flex items-center gap-2">
                            <i class="bx bx-list-check"></i>
                            Servicios a Realizar
                        </h2>

                        <div class="space-y-4">
                            <div class="flex gap-4 items-end">
                                <div class="flex-1">
                                    <label class="block text-sm font-medium text-gray-300 mb-2">
                                        Seleccionar Servicio
                                    </label>
                                    <select id="selectTipoServicio"
                                        class="w-full bg-black/30 border border-gray-700 text-white p-3 rounded-lg focus:border-orange-500">
                                        <option value="">Selecciona un tipo de servicio</option>
                                        <option value="1" data-costo="450.00">Cambio de Aceite y Filtro - $450.00</option>
                                        <option value="2" data-costo="300.00">Rotación de Llantas - $300.00</option>
                                        <option value="3" data-costo="700.00">Revisión General - $700.00</option>
                                        <option value="4" data-costo="1200.00">Alineación y Balanceo - $1,200.00</option>
                                        <option value="5" data-costo="850.00">Cambio de Frenos - $850.00</option>
                                    </select>
                                </div>
                                <div class="w-32">
                                    <label class="block text-sm font-medium text-gray-300 mb-2">
                                        Costo
                                    </label>
                                    <input type="text" id="inputCostoServicio" readonly
                                        class="w-full bg-black/30 border border-gray-700 text-white p-3 rounded-lg">
                                </div>
                                <button type="button" onclick="agregarServicio()" 
                                    class="bg-orange-600 hover:bg-orange-500 transition px-4 py-3 rounded-lg">
                                    <i class="bx bx-plus"></i> Agregar
                                </button>
                            </div>

                            <!-- Lista de Servicios Agregados -->
                            <div class="bg-black/30 rounded-lg border border-gray-700">
                                <table class="w-full text-sm">
                                    <thead class="border-b border-gray-700 text-orange-400">
                                        <tr>
                                            <th class="py-3 text-left px-4">Servicio</th>
                                            <th class="text-left">Notas</th>
                                            <th class="text-right px-4">Costo</th>
                                            <th class="text-center w-20">Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody id="listaServicios">
                                        <!-- Los servicios se agregarán dinámicamente aquí -->
                                    </tbody>
                                </table>
                                <div id="mensajeSinServicios" class="text-center py-4 text-gray-400">
                                    No hay servicios agregados
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sección 4: Refacciones -->
                    <div class="bg-[#1A1A1A] p-6 rounded-xl border border-gray-700">
                        <h2 class="text-xl font-bold text-orange-400 mb-4 flex items-center gap-2">
                            <i class="bx bx-cog"></i>
                            Refacciones
                        </h2>

                        <div class="space-y-4">
                            <div class="flex gap-4 items-end">
                                <div class="flex-1">
                                    <label class="block text-sm font-medium text-gray-300 mb-2">
                                        Seleccionar Refacción
                                    </label>
                                    <select id="selectRefaccion"
                                        class="w-full bg-black/30 border border-gray-700 text-white p-3 rounded-lg focus:border-orange-500">
                                        <option value="">Selecciona una refacción</option>
                                        <option value="1" data-precio="250.00" data-stock="15">Aceite Sintético 5W-30 - $250.00 (Stock: 15)</option>
                                        <option value="2" data-precio="180.00" data-stock="8">Filtro de Aceite - $180.00 (Stock: 8)</option>
                                        <option value="3" data-precio="450.00" data-stock="12">Pastillas de Freno - $450.00 (Stock: 12)</option>
                                        <option value="4" data-precio="320.00" data-stock="20">Bujías - $320.00 (Stock: 20)</option>
                                    </select>
                                </div>
                                <div class="w-24">
                                    <label class="block text-sm font-medium text-gray-300 mb-2">
                                        Cantidad
                                    </label>
                                    <input type="number" id="inputCantidadRefaccion" min="1" value="1"
                                        class="w-full bg-black/30 border border-gray-700 text-white p-3 rounded-lg focus:border-orange-500">
                                </div>
                                <div class="w-32">
                                    <label class="block text-sm font-medium text-gray-300 mb-2">
                                        Precio Unitario
                                    </label>
                                    <input type="text" id="inputPrecioRefaccion" readonly
                                        class="w-full bg-black/30 border border-gray-700 text-white p-3 rounded-lg">
                                </div>
                                <button type="button" onclick="agregarRefaccion()" 
                                    class="bg-orange-600 hover:bg-orange-500 transition px-4 py-3 rounded-lg">
                                    <i class="bx bx-plus"></i> Agregar
                                </button>
                            </div>

                            <!-- Lista de Refacciones Agregadas -->
                            <div class="bg-black/30 rounded-lg border border-gray-700">
                                <table class="w-full text-sm">
                                    <thead class="border-b border-gray-700 text-orange-400">
                                        <tr>
                                            <th class="py-3 text-left px-4">Refacción</th>
                                            <th class="text-center">Cantidad</th>
                                            <th class="text-right px-4">Precio Unit.</th>
                                            <th class="text-right px-4">Subtotal</th>
                                            <th class="text-center w-20">Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody id="listaRefacciones">
                                        <!-- Las refacciones se agregarán dinámicamente aquí -->
                                    </tbody>
                                </table>
                                <div id="mensajeSinRefacciones" class="text-center py-4 text-gray-400">
                                    No hay refacciones agregadas
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sección 5: Resumen y Total -->
                    <div class="bg-[#1A1A1A] p-6 rounded-xl border border-gray-700">
                        <h2 class="text-xl font-bold text-orange-400 mb-4 flex items-center gap-2">
                            <i class="bx bx-calculator"></i>
                            Resumen y Total
                        </h2>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="space-y-4">
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-300">Subtotal Servicios:</span>
                                    <span class="text-lg" id="subtotalServicios">$0.00</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-300">Subtotal Refacciones:</span>
                                    <span class="text-lg" id="subtotalRefacciones">$0.00</span>
                                </div>
                                <div class="flex justify-between items-center pt-4 border-t border-gray-700">
                                    <span class="text-xl font-bold text-orange-400">Total:</span>
                                    <span class="text-2xl font-bold text-green-400" id="totalGeneral">$0.00</span>
                                </div>
                            </div>

                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">
                                        Próximo Servicio (KM)
                                    </label>
                                    <input type="number" id="inputProximoServicioKm"
                                        class="w-full bg-black/30 border border-gray-700 text-white p-3 rounded-lg focus:border-orange-500"
                                        placeholder="Ej: 50000">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">
                                        Fecha Próximo Servicio
                                    </label>
                                    <input type="date" id="inputFechaProximoServicio"
                                        class="w-full bg-black/30 border border-gray-700 text-white p-3 rounded-lg focus:border-orange-500">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Botones de Acción -->
                    <div class="flex justify-end gap-4 pt-6">
                        <a href="/admin/servicios.html" 
                           class="px-8 py-3 bg-gray-700 hover:bg-gray-600 rounded-lg font-medium transition">
                            Cancelar
                        </a>
                        <button type="submit"
                            class="px-8 py-3 bg-orange-600 hover:bg-orange-500 rounded-lg font-medium transition flex items-center gap-2">
                            <i class="bx bx-save"></i>
                            Guardar Servicio
                        </button>
                    </div>
                </form>
            </div>
        </section>
    </main>

    <!-- Modal Agregar Vehículo -->
    <div id="modalVehiculo" class="fixed inset-0 bg-black/70 backdrop-blur-md hidden justify-center items-center z-50 p-4">
        <div class="bg-[#1A1A1A]/95 p-8 rounded-2xl shadow-xl border border-orange-500/30 w-full max-w-2xl animate-[zoomIn_.3s_ease] relative max-h-[90vh] overflow-y-auto">
            <button onclick="cerrarModalVehiculo()" class="absolute top-3 right-3 text-gray-400 hover:text-white text-xl">
                <i class="bx bx-x"></i>
            </button>

            <h2 class="text-2xl font-bold mb-6 text-orange-500">Agregar Vehículo Nuevo</h2>

            <form id="formVehiculo" class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">
                            Marca *
                        </label>
                        <select id="selectMarca" required
                            class="w-full bg-black/30 border border-gray-700 text-white p-3 rounded-lg focus:border-orange-500">
                            <option value="">Selecciona una marca</option>
                            <option value="1">Toyota</option>
                            <option value="2">Honda</option>
                            <option value="3">Nissan</option>
                            <option value="4">Ford</option>
                            <option value="5">Chevrolet</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">
                            Modelo *
                        </label>
                        <select id="selectModelo" required
                            class="w-full bg-black/30 border border-gray-700 text-white p-3 rounded-lg focus:border-orange-500">
                            <option value="">Selecciona un modelo</option>
                        </select>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">
                            Año *
                        </label>
                        <input type="number" id="inputAnio" required min="1990" max="2024"
                            class="w-full bg-black/30 border border-gray-700 text-white p-3 rounded-lg focus:border-orange-500"
                            placeholder="Ej: 2022">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">
                            Número de Serie *
                        </label>
                        <input type="text" id="inputNumeroSerie" required
                            class="w-full bg-black/30 border border-gray-700 text-white p-3 rounded-lg focus:border-orange-500"
                            placeholder="Número de serie del vehículo">
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">
                            Placas *
                        </label>
                        <input type="text" id="inputPlacas" required
                            class="w-full bg-black/30 border border-gray-700 text-white p-3 rounded-lg focus:border-orange-500"
                            placeholder="Ej: ABC-1234">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">
                            Color *
                        </label>
                        <input type="text" id="inputColorVehiculo" required
                            class="w-full bg-black/30 border border-gray-700 text-white p-3 rounded-lg focus:border-orange-500"
                            placeholder="Color del vehículo">
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">
                            Kilometraje Actual *
                        </label>
                        <input type="number" id="inputKilometrajeVehiculo" required
                            class="w-full bg-black/30 border border-gray-700 text-white p-3 rounded-lg focus:border-orange-500"
                            placeholder="Ej: 45000">
                    </div>
                </div>

                <div class="border-t border-gray-700 pt-6">
                    <h3 class="text-lg font-semibold text-orange-400 mb-4">Seleccionar Cliente</h3>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">
                            Cliente Existente *
                        </label>
                        <select id="selectCliente" required
                            class="w-full bg-black/30 border border-gray-700 text-white p-3 rounded-lg focus:border-orange-500">
                            <option value="">Selecciona un cliente existente</option>
                            <option value="1">Juan Pérez García - juan@email.com</option>
                            <option value="2">María López Hernández - maria@email.com</option>
                            <option value="3">Carlos Rodríguez - carlos@email.com</option>
                            <option value="4">Ana Martínez - ana@email.com</option>
                            <option value="5">Roberto Sánchez - roberto@email.com</option>
                        </select>
                        <p class="mt-1 text-xs text-gray-400">Solo se permiten clientes existentes en el sistema</p>
                    </div>
                </div>

                <div class="flex justify-end gap-3 pt-6 border-t border-gray-700">
                    <button type="button" onclick="cerrarModalVehiculo()"
                        class="px-6 py-3 bg-gray-700 hover:bg-gray-600 rounded-lg">
                        Cancelar
                    </button>

                    <button type="submit" class="px-6 py-3 bg-orange-600 hover:bg-orange-500 rounded-lg font-semibold">
                        Guardar Vehículo
                    </button>
                </div>
            </form>
        </div>
    </div>

    <style>
        @keyframes zoomIn {
            0% {
                opacity: 0;
                transform: scale(0.85);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            box-shadow: 0 0 0 2px rgba(255, 140, 0, 0.2);
        }
    </style>

    <script>
        // Datos globales
        let serviciosAgregados = [];
        let refaccionesAgregadas = [];

        // Inicializar la página
        document.addEventListener('DOMContentLoaded', function() {
            configurarEventos();
            actualizarTotales();
            configurarFechas();
        });

        // Configurar eventos
        function configurarEventos() {
            // Submenú de Catálogos
            const btnCatalogos = document.getElementById("btnCatalogos");
            const submenu = document.getElementById("submenuCatalogos");
            const iconArrow = document.getElementById("iconArrow");

            btnCatalogos.addEventListener("click", () => {
                submenu.classList.toggle("hidden");
                iconArrow.classList.toggle("bx-chevron-down");
                iconArrow.classList.toggle("bx-chevron-up");
            });

            // Cambio en selección de vehículo
            document.getElementById('selectVehiculo').addEventListener('change', function() {
                actualizarInfoVehiculo(this.value);
                actualizarKilometrajeDesdeSelect(this.value);
            });

            // Cambio en selección de tipo de servicio
            document.getElementById('selectTipoServicio').addEventListener('change', function() {
                const selectedOption = this.options[this.selectedIndex];
                const costo = selectedOption.getAttribute('data-costo') || '0.00';
                document.getElementById('inputCostoServicio').value = '$' + costo;
            });

            // Cambio en selección de refacción
            document.getElementById('selectRefaccion').addEventListener('change', function() {
                const selectedOption = this.options[this.selectedIndex];
                const precio = selectedOption.getAttribute('data-precio') || '0.00';
                document.getElementById('inputPrecioRefaccion').value = '$' + precio;
            });

            // Cambio en cantidad de refacción
            document.getElementById('inputCantidadRefaccion').addEventListener('input', function() {
                const cantidad = parseInt(this.value) || 0;
                const precio = parseFloat(document.getElementById('inputPrecioRefaccion').value.replace('$', '')) || 0;
                if (cantidad > 0 && precio > 0) {
                    // Aquí podrías validar stock si es necesario
                }
            });

            // Formularios
            document.getElementById('formCrearServicio').addEventListener('submit', function(e) {
                e.preventDefault();
                guardarServicio();
            });

            document.getElementById('formVehiculo').addEventListener('submit', function(e) {
                e.preventDefault();
                guardarVehiculo();
            });
        }

        // Configurar fechas por defecto
        function configurarFechas() {
            const hoy = new Date();
            const fechaEstimada = new Date();
            fechaEstimada.setDate(hoy.getDate() + 3); // 3 días después

            document.getElementById('inputFechaEstimada').value = fechaEstimada.toISOString().split('T')[0];
            
            const proximoServicio = new Date();
            proximoServicio.setMonth(hoy.getMonth() + 6); // 6 meses después
            document.getElementById('inputFechaProximoServicio').value = proximoServicio.toISOString().split('T')[0];
        }

        // Actualizar información del vehículo seleccionado
        function actualizarInfoVehiculo(vehiculoId) {
            const infoDiv = document.getElementById('infoVehiculo');
            
            if (!vehiculoId) {
                infoDiv.innerHTML = '<p class="text-center py-8">Selecciona un vehículo para ver su información</p>';
                return;
            }

            // Datos de ejemplo - en producción esto vendría de una API
            const vehiculos = {
                '1': {
                    vehiculo: 'Toyota Corolla 2022',
                    placas: 'ABC-1234',
                    color: 'Blanco',
                    kilometraje: '45,000 km',
                    cliente: 'Juan Pérez García',
                    telefono: '+52 555 123 4567',
                    email: 'juan@email.com'
                },
                '2': {
                    vehiculo: 'Honda Civic 2023',
                    placas: 'DEF-5678',
                    color: 'Negro',
                    kilometraje: '32,500 km',
                    cliente: 'María López Hernández',
                    telefono: '+52 555 987 6543',
                    email: 'maria@email.com'
                },
                '3': {
                    vehiculo: 'Nissan Sentra 2021',
                    placas: 'GHI-9012',
                    color: 'Rojo',
                    kilometraje: '68,200 km',
                    cliente: 'Carlos Rodríguez',
                    telefono: '+52 555 456 7890',
                    email: 'carlos@email.com'
                },
                '4': {
                    vehiculo: 'Ford Focus 2020',
                    placas: 'JKL-3456',
                    color: 'Azul',
                    kilometraje: '89,100 km',
                    cliente: 'Ana Martínez',
                    telefono: '+52 555 234 5678',
                    email: 'ana@email.com'
                },
                '5': {
                    vehiculo: 'Chevrolet Aveo 2023',
                    placas: 'MNO-7890',
                    color: 'Gris',
                    kilometraje: '23,400 km',
                    cliente: 'Roberto Sánchez',
                    telefono: '+52 555 345 6789',
                    email: 'roberto@email.com'
                }
            };

            const vehiculo = vehiculos[vehiculoId];
            if (vehiculo) {
                infoDiv.innerHTML = `
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-gray-400">Vehículo:</span>
                            <span class="font-medium">${vehiculo.vehiculo}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">Placas:</span>
                            <span class="font-mono">${vehiculo.placas}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">Color:</span>
                            <span>${vehiculo.color}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">Kilometraje:</span>
                            <span class="font-medium text-orange-400">${vehiculo.kilometraje}</span>
                        </div>
                        <div class="border-t border-gray-600 pt-3 mt-3">
                            <div class="flex justify-between">
                                <span class="text-gray-400">Cliente:</span>
                                <span class="font-medium">${vehiculo.cliente}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Teléfono:</span>
                                <span>${vehiculo.telefono}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Email:</span>
                                <span>${vehiculo.email}</span>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        // Actualizar kilometraje desde el select
        function actualizarKilometrajeDesdeSelect(vehiculoId) {
            const select = document.getElementById('selectVehiculo');
            const selectedOption = select.options[select.selectedIndex];
            
            if (selectedOption && selectedOption.value) {
                const kilometraje = selectedOption.getAttribute('data-kilometraje');
                if (kilometraje) {
                    document.getElementById('inputKilometraje').value = kilometraje;
                }
            }
        }

        // Toggle campos de persona que entrega
        function togglePersonaEntrega() {
            const checkbox = document.getElementById('checkLlevadoPorOtro');
            const fields = document.getElementById('personaEntregaFields');
            
            if (checkbox.checked) {
                fields.classList.remove('hidden');
                // Hacer requeridos los campos
                document.getElementById('inputQuienEntrego').required = true;
                document.getElementById('inputTelefonoQuienEntrego').required = true;
            } else {
                fields.classList.add('hidden');
                // Quitar requerido
                document.getElementById('inputQuienEntrego').required = false;
                document.getElementById('inputTelefonoQuienEntrego').required = false;
                // Limpiar campos
                document.getElementById('inputQuienEntrego').value = '';
                document.getElementById('inputTelefonoQuienEntrego').value = '';
            }
        }

        // Agregar servicio a la lista
        function agregarServicio() {
            const select = document.getElementById('selectTipoServicio');
            const selectedOption = select.options[select.selectedIndex];
            
            if (!selectedOption.value) {
                alert('Por favor selecciona un servicio');
                return;
            }

            const servicio = {
                id: selectedOption.value,
                nombre: selectedOption.text.split(' - ')[0],
                costo: parseFloat(selectedOption.getAttribute('data-costo')),
                notas: ''
            };

            serviciosAgregados.push(servicio);
            actualizarListaServicios();
            actualizarTotales();
            
            // Limpiar selección
            select.selectedIndex = 0;
            document.getElementById('inputCostoServicio').value = '';
        }

        // Agregar refacción a la lista
        function agregarRefaccion() {
            const select = document.getElementById('selectRefaccion');
            const selectedOption = select.options[select.selectedIndex];
            const cantidad = parseInt(document.getElementById('inputCantidadRefaccion').value) || 1;
            
            if (!selectedOption.value) {
                alert('Por favor selecciona una refacción');
                return;
            }

            const precio = parseFloat(selectedOption.getAttribute('data-precio'));
            const refaccion = {
                id: selectedOption.value,
                nombre: selectedOption.text.split(' - ')[0],
                cantidad: cantidad,
                precio: precio,
                subtotal: cantidad * precio
            };

            refaccionesAgregadas.push(refaccion);
            actualizarListaRefacciones();
            actualizarTotales();
            
            // Limpiar selección
            select.selectedIndex = 0;
            document.getElementById('inputCantidadRefaccion').value = '1';
            document.getElementById('inputPrecioRefaccion').value = '';
        }

        // Actualizar lista de servicios
        function actualizarListaServicios() {
            const tbody = document.getElementById('listaServicios');
            const mensaje = document.getElementById('mensajeSinServicios');
            
            tbody.innerHTML = '';
            
            if (serviciosAgregados.length === 0) {
                mensaje.style.display = 'block';
                return;
            }
            
            mensaje.style.display = 'none';
            
            serviciosAgregados.forEach((servicio, index) => {
                const tr = document.createElement('tr');
                tr.className = 'border-b border-gray-700 hover:bg-black/40';
                tr.innerHTML = `
                    <td class="py-3 px-4">${servicio.nombre}</td>
                    <td>
                        <input type="text" class="w-full bg-transparent border-none focus:bg-black/30 p-2 rounded" 
                               placeholder="Notas adicionales..." value="${servicio.notas}"
                               onchange="actualizarNotasServicio(${index}, this.value)">
                    </td>
                    <td class="text-right px-4 text-green-400">$${servicio.costo.toFixed(2)}</td>
                    <td class="text-center">
                        <button onclick="eliminarServicio(${index})" class="text-red-400 hover:text-red-300">
                            <i class="bx bx-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Actualizar lista de refacciones
        function actualizarListaRefacciones() {
            const tbody = document.getElementById('listaRefacciones');
            const mensaje = document.getElementById('mensajeSinRefacciones');
            
            tbody.innerHTML = '';
            
            if (refaccionesAgregadas.length === 0) {
                mensaje.style.display = 'block';
                return;
            }
            
            mensaje.style.display = 'none';
            
            refaccionesAgregadas.forEach((refaccion, index) => {
                const tr = document.createElement('tr');
                tr.className = 'border-b border-gray-700 hover:bg-black/40';
                tr.innerHTML = `
                    <td class="py-3 px-4">${refaccion.nombre}</td>
                    <td class="text-center">${refaccion.cantidad}</td>
                    <td class="text-right px-4 text-green-400">$${refaccion.precio.toFixed(2)}</td>
                    <td class="text-right px-4 text-green-400">$${refaccion.subtotal.toFixed(2)}</td>
                    <td class="text-center">
                        <button onclick="eliminarRefaccion(${index})" class="text-red-400 hover:text-red-300">
                            <i class="bx bx-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Actualizar totales
        function actualizarTotales() {
            const subtotalServicios = serviciosAgregados.reduce((sum, servicio) => sum + servicio.costo, 0);
            const subtotalRefacciones = refaccionesAgregadas.reduce((sum, refaccion) => sum + refaccion.subtotal, 0);
            const total = subtotalServicios + subtotalRefacciones;

            document.getElementById('subtotalServicios').textContent = '$' + subtotalServicios.toFixed(2);
            document.getElementById('subtotalRefacciones').textContent = '$' + subtotalRefacciones.toFixed(2);
            document.getElementById('totalGeneral').textContent = '$' + total.toFixed(2);
        }

        // Eliminar servicio
        function eliminarServicio(index) {
            serviciosAgregados.splice(index, 1);
            actualizarListaServicios();
            actualizarTotales();
        }

        // Eliminar refacción
        function eliminarRefaccion(index) {
            refaccionesAgregadas.splice(index, 1);
            actualizarListaRefacciones();
            actualizarTotales();
        }

        // Actualizar notas del servicio
        function actualizarNotasServicio(index, notas) {
            serviciosAgregados[index].notas = notas;
        }

        // Modal functions
        function abrirModalVehiculo() {
            document.getElementById('modalVehiculo').classList.remove('hidden');
        }

        function cerrarModalVehiculo() {
            document.getElementById('modalVehiculo').classList.add('hidden');
        }

        // Cargar modelos según marca seleccionada
        function cargarModelos(marcaId) {
            const selectModelo = document.getElementById('selectModelo');
            selectModelo.innerHTML = '<option value="">Selecciona un modelo</option>';

            // Datos de ejemplo - en producción esto vendría de una API
            const modelos = {
                '1': ['Corolla', 'Camry', 'RAV4', 'Hilux'],
                '2': ['Civic', 'Accord', 'CR-V', 'HR-V'],
                '3': ['Sentra', 'Versa', 'Altima', 'Kicks'],
                '4': ['Focus', 'Fiesta', 'Escape', 'Ranger'],
                '5': ['Aveo', 'Spark', 'Cruze', 'Tracker']
            };

            if (marcaId && modelos[marcaId]) {
                modelos[marcaId].forEach(modelo => {
                    const option = document.createElement('option');
                    option.value = modelo;
                    option.textContent = modelo;
                    selectModelo.appendChild(option);
                });
            }
        }

        // Guardar servicio
        function guardarServicio() {
            // Validaciones básicas
            const vehiculoId = document.getElementById('selectVehiculo').value;
            const kilometraje = document.getElementById('inputKilometraje').value;
            const tipoMantenimiento = document.getElementById('selectTipoMantenimiento').value;
            const fechaEstimada = document.getElementById('inputFechaEstimada').value;

            if (!vehiculoId || !kilometraje || !tipoMantenimiento || !fechaEstimada) {
                alert('Por favor completa todos los campos requeridos');
                return;
            }

            if (serviciosAgregados.length === 0 && refaccionesAgregadas.length === 0) {
                alert('Debes agregar al menos un servicio o refacción');
                return;
            }

            // Validar campos de persona que entrega si el checkbox está marcado
            const llevadoPorOtro = document.getElementById('checkLlevadoPorOtro').checked;
            if (llevadoPorOtro) {
                const quienEntrego = document.getElementById('inputQuienEntrego').value;
                const telefono = document.getElementById('inputTelefonoQuienEntrego').value;
                
                if (!quienEntrego || !telefono) {
                    alert('Por favor completa los datos de la persona que entrega el vehículo');
                    return;
                }
            }

            // Preparar datos para enviar
            const servicioData = {
                vehiculoId: vehiculoId,
                kilometraje: kilometraje,
                tipoMantenimiento: tipoMantenimiento,
                fechaEstimada: fechaEstimada,
                observaciones: document.getElementById('textareaObservaciones').value,
                servicios: serviciosAgregados,
                refacciones: refaccionesAgregadas,
                proximoServicioKm: document.getElementById('inputProximoServicioKm').value,
                fechaProximoServicio: document.getElementById('inputFechaProximoServicio').value,
                costoTotal: parseFloat(document.getElementById('totalGeneral').textContent.replace('$', '')),
                llevadoPorOtro: llevadoPorOtro,
                quienEntrego: llevadoPorOtro ? document.getElementById('inputQuienEntrego').value : '',
                telefonoQuienEntrego: llevadoPorOtro ? document.getElementById('inputTelefonoQuienEntrego').value : ''
            };

            // En producción, aquí enviarías los datos al servidor
            console.log('Datos del servicio:', servicioData);
            
            // Simular éxito
            alert('Servicio creado exitosamente');
            window.location.href = '/admin/servicios.html';
        }

        // Guardar vehículo
        function guardarVehiculo() {
            // Validar formulario de vehículo
            // En producción, aquí enviarías los datos al servidor
            alert('Vehículo guardado exitosamente');
            cerrarModalVehiculo();
            
            // Actualizar select de vehículos
            const selectVehiculo = document.getElementById('selectVehiculo');
            const nuevaOpcion = document.createElement('option');
            nuevaOpcion.value = 'nuevo';
            nuevaOpcion.textContent = document.getElementById('inputPlacas').value + ' - Nuevo Vehículo';
            nuevaOpcion.setAttribute('data-kilometraje', document.getElementById('inputKilometrajeVehiculo').value);
            selectVehiculo.appendChild(nuevaOpcion);
            selectVehiculo.value = 'nuevo';
            actualizarInfoVehiculo('nuevo');
            actualizarKilometrajeDesdeSelect('nuevo');
        }

        // Cerrar modales con ESC
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                cerrarModalVehiculo();
            }
        });
    </script>
</body>

</html>