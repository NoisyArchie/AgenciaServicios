<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <title>Clientes - Siscare</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />
</head>

<body class="bg-[#0D0D0D] text-white min-h-screen flex">
<!-- SIDEBAR -->
<aside class="w-64 bg-black/80 border-r border-orange-600/20 flex flex-col justify-between py-6 px-4">
    <div>
        <h2 class="text-3xl font-bold text-orange-500 border-b border-gray-700 pb-2 mb-6 text-center">
            Siscare
        </h2>

        <nav class="flex flex-col gap-1">
            <a href="/trabajador/panelTrabajador.html" class="flex items-center gap-3 p-3 rounded hover:bg-orange-500/20 transition">
                <i class="bx bx-home text-xl"></i> Panel
            </a>

            <a href="/trabajador/servicios.html" class="flex items-center gap-3 p-3 rounded hover:bg-orange-500/20 transition">
                <i class="bx bx-wrench text-xl"></i> Servicios
            </a>

            <a href="/trabajador/clientes.html" class="flex items-center gap-3 p-3 rounded bg-orange-500/20 transition">
                <i class="bx bx-user text-xl"></i> Clientes
            </a>
        </nav>
    </div>

    <div class="border-t border-gray-700 pt-4">
        <button onclick="cerrarSesion()" class="w-full flex items-center gap-3 p-3 hover:bg-red-500/30 rounded transition text-red-400">
            <i class="bx bx-log-out text-xl"></i> Cerrar Sesión
        </button>
    </div>
</aside>

<!-- CONTENIDO PRINCIPAL -->
<main class="flex-1 flex flex-col">
    <!-- NAVBAR SUPERIOR -->
    <header class="flex justify-between items-center px-8 py-4 border-b border-gray-800 bg-[#111]/80 backdrop-blur-sm">
        <!-- Icono de usuario -->
        <div class="flex items-center gap-3">
            <span id="usuarioNombre" class="text-gray-300 text-sm">Trabajador</span>
            <button class="bg-orange-600 hover:bg-orange-500 p-2 rounded-full transition">
                <i class="bx bx-user text-white text-xl"></i>
            </button>
        </div>
    </header>

    <!-- CONTENIDO -->
    <section class="p-8 flex-1 overflow-y-auto">
        <div class="flex justify-between items-center mb-6">
            <div>
                <h1 class="text-3xl font-bold">Gestión de Clientes</h1>
                <p class="text-gray-400 text-sm">
                    Administra los clientes del sistema
                </p>
            </div>

            <div class="flex gap-3">
                <a href="/trabajador/altaVehiculoCliente.html"
                   class="flex items-center gap-2 bg-blue-600 hover:bg-blue-500 transition px-4 py-2 rounded shadow">
                    <i class="bx bx-car"></i> Agregar Vehículo
                </a>
                <a href="/trabajador/altaClientes.html"
                   class="flex items-center gap-2 bg-orange-600 hover:bg-orange-500 transition px-4 py-2 rounded shadow">
                    <i class="bx bx-plus"></i> Nuevo Cliente
                </a>
            </div>
        </div>

        <!-- Filtros -->
        <div class="bg-[#1A1A1A] p-4 rounded-xl border border-gray-700 mb-6">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="md:col-span-2">
                    <label class="block text-sm text-gray-300 mb-2">Buscar Cliente</label>
                    <div class="flex gap-2">
                        <input type="text" id="inputBuscarCliente" placeholder="Buscar por nombre, email o teléfono"
                               class="flex-1 bg-black/30 border border-gray-700 text-white p-2 rounded-lg focus:border-orange-500">
                        <button onclick="buscarClientes()" class="bg-orange-600 hover:bg-orange-500 transition px-4 py-2 rounded">
                            <i class="bx bx-search"></i> Buscar
                        </button>
                    </div>
                </div>
                <div>
                    <label class="block text-sm text-gray-300 mb-2">Estado</label>
                    <select id="selectEstado" class="w-full bg-black/30 border border-gray-700 text-white p-2 rounded-lg">
                        <option value="">Todos los estados</option>
                        <option value="activo">Activo</option>
                        <option value="inactivo">Inactivo</option>
                    </select>
                </div>
            </div>
            <div class="flex justify-end gap-2 mt-4">
                <button onclick="aplicarFiltros()" class="bg-orange-600 hover:bg-orange-500 transition px-4 py-2 rounded">
                    Aplicar Filtros
                </button>
                <button onclick="limpiarFiltros()" class="bg-gray-700 hover:bg-gray-600 transition px-4 py-2 rounded">
                    Limpiar
                </button>
            </div>
        </div>

        <!-- Loader -->
        <div id="loader" class="hidden text-center py-8">
            <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-orange-600"></div>
            <p class="mt-2 text-gray-400">Cargando clientes...</p>
        </div>

        <!-- Tabla de Clientes -->
        <div class="bg-[#1A1A1A] p-4 rounded-xl border border-gray-700">
            <table class="w-full text-sm">
                <thead class="border-b border-gray-700 text-orange-400">
                <tr>
                    <th class="py-3 text-left">ID</th>
                    <th class="text-left">Nombre Completo</th>
                    <th class="text-left">Teléfono</th>
                    <th class="text-left">Email</th>
                    <th class="text-left">Fecha Registro</th>
                    <th class="text-left">Estado</th>
                    <th class="text-center">Acciones</th>
                </tr>
                </thead>

                <tbody id="tablaClientes">
                <!-- Los clientes se cargarán dinámicamente aquí -->
                </tbody>
            </table>

            <!-- Paginación -->
            <div class="flex justify-between items-center mt-4 pt-4 border-t border-gray-700">
                <div class="text-gray-400 text-sm" id="infoPaginacion">
                    Mostrando 0 de 0 clientes
                </div>
                <div class="flex gap-2">
                    <button onclick="cambiarPagina('anterior')" class="px-3 py-1 bg-gray-700 hover:bg-gray-600 rounded transition">
                        <i class="bx bx-chevron-left"></i>
                    </button>
                    <button onclick="irAPagina(1)" id="pagina1" class="px-3 py-1 bg-orange-600 text-white rounded">1</button>
                    <button onclick="irAPagina(2)" id="pagina2" class="px-3 py-1 bg-gray-700 hover:bg-gray-600 rounded transition">2</button>
                    <button onclick="irAPagina(3)" id="pagina3" class="px-3 py-1 bg-gray-700 hover:bg-gray-600 rounded transition">3</button>
                    <button onclick="cambiarPagina('siguiente')" class="px-3 py-1 bg-gray-700 hover:bg-gray-600 rounded transition">
                        <i class="bx bx-chevron-right"></i>
                    </button>
                </div>
            </div>
        </div>
    </section>
</main>

<!-- Modal Detalle Cliente -->
<div id="modalDetalleCliente" class="fixed inset-0 bg-black/70 backdrop-blur-md hidden justify-center items-center z-50 p-4">
    <div class="bg-[#1A1A1A]/95 p-8 rounded-2xl shadow-xl border border-orange-500/30 w-full max-w-2xl animate-[zoomIn_.3s_ease] relative max-h-[90vh] overflow-y-auto">
        <button onclick="cerrarModalDetalle()" class="absolute top-3 right-3 text-gray-400 hover:text-white text-xl">
            <i class="bx bx-x"></i>
        </button>

        <h2 class="text-2xl font-bold mb-6 text-orange-500">Detalle del Cliente</h2>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <!-- Información Personal -->
            <div class="bg-black/30 p-4 rounded-lg border border-gray-700">
                <h3 class="text-lg font-semibold text-orange-400 mb-3">Información Personal</h3>
                <div class="space-y-2 text-sm">
                    <div class="flex justify-between">
                        <span class="text-gray-400">Nombre:</span>
                        <span class="font-medium" id="detalleNombre">-</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Email:</span>
                        <span id="detalleEmail">-</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Teléfono:</span>
                        <span id="detalleTelefono">-</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Fecha Registro:</span>
                        <span id="detalleFechaRegistro">-</span>
                    </div>
                </div>
            </div>

            <!-- Información de Contacto -->
            <div class="bg-black/30 p-4 rounded-lg border border-gray-700">
                <h3 class="text-lg font-semibold text-orange-400 mb-3">Información de Contacto</h3>
                <div class="space-y-2 text-sm">
                    <div class="flex justify-between">
                        <span class="text-gray-400">Dirección:</span>
                        <span id="detalleDireccion" class="text-right">-</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Estado:</span>
                        <span id="detalleEstado">-</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Vehículos del Cliente -->
        <div class="bg-black/30 p-4 rounded-lg border border-gray-700 mb-6">
            <div class="flex justify-between items-center mb-3">
                <h3 class="text-lg font-semibold text-orange-400">Vehículos del Cliente</h3>
                <a href="/trabajador/altaVehiculoCliente.html"
                   class="flex items-center gap-1 bg-blue-600 hover:bg-blue-500 transition px-3 py-1 rounded text-sm">
                    <i class="bx bx-plus"></i> Agregar Vehículo
                </a>
            </div>
            <div class="space-y-2" id="listaVehiculosCliente">
                <p class="text-gray-400 text-center">Cargando vehículos...</p>
            </div>
        </div>

        <!-- Historial de Servicios -->
        <div class="bg-black/30 p-4 rounded-lg border border-gray-700">
            <h3 class="text-lg font-semibold text-orange-400 mb-3">Últimos Servicios</h3>
            <div class="space-y-2" id="listaServiciosCliente">
                <p class="text-gray-400 text-center">Cargando servicios...</p>
            </div>
        </div>
    </div>
</div>

<!-- Modal Editar Cliente -->
<div id="modalEditarCliente" class="fixed inset-0 bg-black/70 backdrop-blur-md hidden justify-center items-center z-50 p-4">
    <div class="bg-[#1A1A1A]/95 p-8 rounded-2xl shadow-xl border border-orange-500/30 w-full max-w-2xl animate-[zoomIn_.3s_ease] relative max-h-[90vh] overflow-y-auto">
        <button onclick="cerrarModalEditar()" class="absolute top-3 right-3 text-gray-400 hover:text-white text-xl">
            <i class="bx bx-x"></i>
        </button>

        <h2 class="text-2xl font-bold mb-6 text-orange-500">Editar Cliente</h2>

        <form id="formEditarCliente" class="space-y-6">
            <input type="hidden" id="clienteIdEditar">

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">
                        Nombre Completo *
                    </label>
                    <input type="text" id="inputNombreEditar" required
                           class="w-full bg-black/30 border border-gray-700 text-white p-3 rounded-lg focus:border-orange-500"
                           placeholder="Nombre completo del cliente">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">
                        Teléfono
                    </label>
                    <input type="tel" id="inputTelefonoEditar"
                           class="w-full bg-black/30 border border-gray-700 text-white p-3 rounded-lg focus:border-orange-500"
                           placeholder="Número de teléfono" maxlength="15">
                </div>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-300 mb-2">
                    Email
                </label>
                <input type="email" id="inputEmailEditar"
                       class="w-full bg-black/30 border border-gray-700 text-white p-3 rounded-lg focus:border-orange-500"
                       placeholder="correo@ejemplo.com" maxlength="100">
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-300 mb-2">
                    Dirección
                </label>
                <textarea id="textareaDireccionEditar" rows="3"
                          class="w-full bg-black/30 border border-gray-700 text-white p-3 rounded-lg focus:border-orange-500 resize-none"
                          placeholder="Dirección completa del cliente"></textarea>
            </div>

            <div class="flex items-center gap-3 pt-4 border-t border-gray-700">
                <input type="checkbox" id="checkActivoEditar" checked
                       class="w-4 h-4 accent-orange-500 bg-black/30 border-gray-700 rounded focus:ring-orange-500">
                <label for="checkActivoEditar" class="text-sm font-medium text-gray-300">
                    Cliente activo
                </label>
            </div>

            <div class="flex justify-end gap-3 pt-6 border-t border-gray-700">
                <button type="button" onclick="cerrarModalEditar()"
                        class="px-6 py-3 bg-gray-700 hover:bg-gray-600 rounded-lg">
                    Cancelar
                </button>

                <button type="submit" class="px-6 py-3 bg-orange-600 hover:bg-orange-500 rounded-lg font-semibold">
                    Guardar Cambios
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Toast -->
<div id="toast" class="hidden fixed bottom-4 right-4 px-6 py-3 rounded-lg shadow-lg text-white z-50">
    <p id="toastMessage"></p>
</div>

<style>
    @keyframes zoomIn {
        0% {
            opacity: 0;
            transform: scale(0.85);
        }
        100% {
            opacity: 1;
            transform: scale(1);
        }
    }

    tbody tr {
        transition: background-color 0.2s ease, transform 0.2s ease;
    }

    tbody tr:hover {
        background-color: rgba(255, 140, 0, 0.05);
        transform: scale(1.01);
    }
</style>

<script>
    const API_URL = 'http://localhost:8080/api/clientes';

    let clientes = [];
    let clientesFiltrados = [];
    let paginaActual = 1;
    const clientesPorPagina = 10;

    // Inicializar
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Página cargada, verificando sesión...');
        verificarSesion();
        cargarClientesDesdeAPI();
        configurarEventos();
    });

    function verificarSesion() {
        return;
    }

    function cerrarSesion() {
        if (confirm('¿Está seguro de cerrar sesión?')) {
            sessionStorage.clear();
            localStorage.clear();
            window.location.href = '../login.html';
        }
    }

    function configurarEventos() {
        document.getElementById('inputBuscarCliente').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                buscarClientes();
            }
        });

        document.getElementById('formEditarCliente').addEventListener('submit', function(e) {
            e.preventDefault();
            actualizarCliente();
        });
    }

    async function cargarClientesDesdeAPI() {
        try {
            console.log('Cargando clientes desde:', API_URL);
            mostrarCargando(true);

            const response = await fetch(API_URL);
            console.log('Respuesta recibida:', response.status, response.statusText);

            if (!response.ok) {
                throw new Error(`Error HTTP: ${response.status} - ${response.statusText}`);
            }

            clientes = await response.json();
            console.log('Clientes cargados:', clientes);
            console.log('Total de clientes:', clientes.length);

            // IMPORTANTE: Copiar TODOS los clientes, no filtrar por activo
            clientesFiltrados = [...clientes];
            cargarClientes();

            mostrarToast(`${clientes.length} clientes cargados correctamente`, 'success');
        } catch (error) {
            console.error('Error detallado:', error);
            mostrarToast(`Error al cargar clientes: ${error.message}`, 'error');

            // Mostrar mensaje en la tabla
            document.getElementById('tablaClientes').innerHTML = `
            <tr>
                <td colspan="7" class="text-center py-8 text-red-400">
                    <i class="bx bx-error text-4xl mb-2 block"></i>
                    <p class="font-bold">Error al cargar clientes</p>
                    <p class="text-sm mt-2">${error.message}</p>
                    <p class="text-xs mt-2 text-gray-500">Verifica que el backend esté ejecutándose en http://localhost:8080</p>
                </td>
            </tr>
        `;
        } finally {
            mostrarCargando(false);
        }
    }

    function cargarClientes() {
        const tabla = document.getElementById('tablaClientes');
        const inicio = (paginaActual - 1) * clientesPorPagina;
        const fin = inicio + clientesPorPagina;
        const clientesPagina = clientesFiltrados.slice(inicio, fin);

        console.log(`Mostrando clientes ${inicio + 1} a ${fin} de ${clientesFiltrados.length} filtrados`);

        tabla.innerHTML = '';

        if (clientesPagina.length === 0) {
            tabla.innerHTML = `
            <tr>
                <td colspan="7" class="text-center py-8 text-gray-400">
                    <i class="bx bx-user-x text-4xl mb-2 block"></i>
                    No se encontraron clientes
                </td>
            </tr>
        `;
            actualizarPaginacion();
            return;
        }

        clientesPagina.forEach(cliente => {
            const fila = document.createElement('tr');
            fila.className = 'border-b border-gray-800 hover:bg-black/40 transition';
            fila.innerHTML = `
            <td class="py-3">${cliente.idCliente}</td>
            <td class="font-medium">${cliente.nombreCompleto}</td>
            <td>${cliente.telefono || 'N/A'}</td>
            <td>${cliente.email || 'N/A'}</td>
            <td>${formatearFecha(cliente.fechaRegistro)}</td>
            <td>
                ${cliente.activo ?
                '<span class="bg-green-500/20 text-green-400 px-2 py-1 rounded-full text-xs">Activo</span>' :
                '<span class="bg-red-500/20 text-red-400 px-2 py-1 rounded-full text-xs">Inactivo</span>'
            }
            </td>
            <td class="text-center">
                <div class="flex gap-2 justify-center">
                    <button onclick="verDetalleCliente(${cliente.idCliente})" class="text-blue-400 hover:text-blue-300" title="Ver Detalles">
                        <i class="bx bx-show text-xl"></i>
                    </button>
                    <button onclick="abrirModalEditar(${cliente.idCliente})" class="text-orange-400 hover:text-orange-300" title="Editar">
                        <i class="bx bx-edit text-xl"></i>
                    </button>
                </div>
            </td>
        `;
            tabla.appendChild(fila);
        });

        actualizarPaginacion();
    }

    function formatearFecha(fecha) {
        if (!fecha) return 'N/A';
        const date = new Date(fecha);
        return date.toLocaleDateString('es-MX');
    }

    async function buscarClientes() {
        const termino = document.getElementById('inputBuscarCliente').value.trim();

        if (!termino) {
            // Si no hay término, mostrar todos los clientes sin filtrar por estado
            clientesFiltrados = [...clientes];
            paginaActual = 1;
            cargarClientes();
            return;
        }

        try {
            console.log('Buscando clientes con término:', termino);
            const response = await fetch(`${API_URL}/buscar?termino=${encodeURIComponent(termino)}`);
            if (response.ok) {
                clientesFiltrados = await response.json();
                console.log('Resultados de búsqueda:', clientesFiltrados.length);
                paginaActual = 1;
                cargarClientes();
            }
        } catch (error) {
            console.error('Error en búsqueda:', error);
            mostrarToast('Error al buscar clientes', 'error');
        }
    }

    function aplicarFiltros() {
        const estado = document.getElementById('selectEstado').value;
        const termino = document.getElementById('inputBuscarCliente').value.trim().toLowerCase();

        console.log('Aplicando filtros - Estado:', estado, 'Término:', termino);

        clientesFiltrados = clientes.filter(cliente => {
            let cumple = true;

            // Filtro por estado
            if (estado === 'activo') {
                cumple = cliente.activo === true;
            } else if (estado === 'inactivo') {
                cumple = cliente.activo === false;
            }
            // Si estado === '', mostrar todos (no filtrar)

            // Filtro por término de búsqueda
            if (cumple && termino) {
                const nombreMatch = cliente.nombreCompleto && cliente.nombreCompleto.toLowerCase().includes(termino);
                const emailMatch = cliente.email && cliente.email.toLowerCase().includes(termino);
                const telefonoMatch = cliente.telefono && cliente.telefono.includes(termino);

                cumple = nombreMatch || emailMatch || telefonoMatch;
            }

            return cumple;
        });

        console.log('Clientes después de filtrar:', clientesFiltrados.length);
        paginaActual = 1;
        cargarClientes();
    }

    function limpiarFiltros() {
        console.log('Limpiando filtros...');
        document.getElementById('inputBuscarCliente').value = '';
        document.getElementById('selectEstado').value = '';

        // Mostrar TODOS los clientes sin ningún filtro
        clientesFiltrados = [...clientes];
        paginaActual = 1;
        cargarClientes();
    }

    function actualizarPaginacion() {
        const totalClientes = clientesFiltrados.length;
        const totalPaginas = Math.ceil(totalClientes / clientesPorPagina);
        const inicio = (paginaActual - 1) * clientesPorPagina + 1;
        const fin = Math.min(paginaActual * clientesPorPagina, totalClientes);

        document.getElementById('infoPaginacion').textContent =
            `Mostrando ${totalClientes > 0 ? inicio : 0}-${fin} de ${totalClientes} clientes`;

        for (let i = 1; i <= 3; i++) {
            const btn = document.getElementById(`pagina${i}`);
            if (i <= totalPaginas) {
                btn.textContent = i;
                btn.style.display = 'block';
                btn.className = `px-3 py-1 ${i === paginaActual ? 'bg-orange-600 text-white' : 'bg-gray-700 hover:bg-gray-600'} rounded transition`;
            } else {
                btn.style.display = 'none';
            }
        }
    }

    function cambiarPagina(direccion) {
        const totalPaginas = Math.ceil(clientesFiltrados.length / clientesPorPagina);

        if (direccion === 'siguiente' && paginaActual < totalPaginas) {
            paginaActual++;
        } else if (direccion === 'anterior' && paginaActual > 1) {
            paginaActual--;
        }

        cargarClientes();
    }

    function irAPagina(numero) {
        paginaActual = numero;
        cargarClientes();
    }

    async function verDetalleCliente(id) {
        try {
            const response = await fetch(`${API_URL}/${id}`);
            if (!response.ok) throw new Error('Error al cargar cliente');

            const cliente = await response.json();

            document.getElementById('detalleNombre').textContent = cliente.nombreCompleto;
            document.getElementById('detalleEmail').textContent = cliente.email || 'No especificado';
            document.getElementById('detalleTelefono').textContent = cliente.telefono || 'No especificado';
            document.getElementById('detalleFechaRegistro').textContent = formatearFecha(cliente.fechaRegistro);
            document.getElementById('detalleDireccion').textContent = cliente.direccion || 'No especificada';
            document.getElementById('detalleEstado').innerHTML = cliente.activo ?
                '<span class="bg-green-500/20 text-green-400 px-2 py-1 rounded-full text-xs">Activo</span>' :
                '<span class="bg-red-500/20 text-red-400 px-2 py-1 rounded-full text-xs">Inactivo</span>';

            // Cargar vehículos del cliente
            await cargarVehiculosCliente(id);

            document.getElementById('listaServiciosCliente').innerHTML =
                '<p class="text-gray-400 text-center">No hay servicios registrados</p>';

            document.getElementById('modalDetalleCliente').classList.remove('hidden');
            document.getElementById('modalDetalleCliente').classList.add('flex');
        } catch (error) {
            console.error('Error:', error);
            mostrarToast('Error al cargar el detalle del cliente', 'error');
        }
    }

    async function cargarVehiculosCliente(clienteId) {
        const contenedor = document.getElementById('listaVehiculosCliente');
        contenedor.innerHTML = '<p class="text-gray-400 text-center">Cargando vehículos...</p>';

        try {
            const response = await fetch(`http://localhost:8080/api/vehiculos/cliente/${clienteId}`);
            if (!response.ok) throw new Error('Error al cargar vehículos');

            const vehiculos = await response.json();
            console.log('Vehículos cargados:', vehiculos);

            if (vehiculos.length === 0) {
                contenedor.innerHTML = `
                <div class="text-center py-4 text-gray-400">
                    <i class="bx bx-car text-2xl mb-2 block"></i>
                    <p>No hay vehículos registrados</p>
                    <a href="/trabajador/altaVehiculoCliente.html"
                       class="inline-block mt-2 bg-blue-600 hover:bg-blue-500 transition px-3 py-1 rounded text-sm">
                        Agregar primer vehículo
                    </a>
                </div>
            `;
                return;
            }

            contenedor.innerHTML = vehiculos.map(vehiculo => `
            <div class="flex justify-between items-center py-2 border-b border-gray-700">
                <div>
                    <p class="font-medium">
                        ${vehiculo.modelo?.marca?.nombreMarca || 'N/A'}
                        ${vehiculo.modelo?.nombreModelo || 'N/A'}
                        ${vehiculo.anio}
                    </p>
                    <p class="text-gray-400 text-sm">
                        Placas: ${vehiculo.placas || 'N/A'} |
                        Color: ${vehiculo.color || 'N/A'} |
                        ${vehiculo.kilometraje ? vehiculo.kilometraje + ' km' : 'N/A'}
                    </p>
                </div>
                <div class="flex gap-2">
                    <button class="text-blue-400 hover:text-blue-300" title="Ver servicios">
                        <i class="bx bx-wrench"></i>
                    </button>
                </div>
            </div>
        `).join('');
        } catch (error) {
            console.error('Error al cargar vehículos:', error);
            contenedor.innerHTML = `
            <div class="text-center py-4 text-red-400">
                <i class="bx bx-error text-2xl mb-2 block"></i>
                <p>Error al cargar vehículos</p>
            </div>
        `;
        }
    }

    async function abrirModalEditar(id) {
        try {
            const response = await fetch(`${API_URL}/${id}`);
            if (!response.ok) throw new Error('Error al cargar cliente');

            const cliente = await response.json();

            document.getElementById('clienteIdEditar').value = cliente.idCliente;
            document.getElementById('inputNombreEditar').value = cliente.nombreCompleto;
            document.getElementById('inputTelefonoEditar').value = cliente.telefono || '';
            document.getElementById('inputEmailEditar').value = cliente.email || '';
            document.getElementById('textareaDireccionEditar').value = cliente.direccion || '';
            document.getElementById('checkActivoEditar').checked = cliente.activo;

            document.getElementById('modalEditarCliente').classList.remove('hidden');
            document.getElementById('modalEditarCliente').classList.add('flex');
        } catch (error) {
            console.error('Error:', error);
            mostrarToast('Error al cargar el cliente', 'error');
        }
    }

    async function actualizarCliente() {
        const id = document.getElementById('clienteIdEditar').value;
        const clienteData = {
            nombreCompleto: document.getElementById('inputNombreEditar').value.trim(),
            telefono: document.getElementById('inputTelefonoEditar').value.trim() || null,
            email: document.getElementById('inputEmailEditar').value.trim() || null,
            direccion: document.getElementById('textareaDireccionEditar').value.trim() || null,
            activo: document.getElementById('checkActivoEditar').checked
        };

        try {
            mostrarCargando(true);
            const response = await fetch(`${API_URL}/${id}`, {
                method: 'PUT',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(clienteData)
            });

            if (!response.ok) throw new Error('Error al actualizar cliente');

            mostrarToast('Cliente actualizado correctamente', 'success');
            cerrarModalEditar();
            cargarClientesDesdeAPI();
        } catch (error) {
            console.error('Error:', error);
            mostrarToast('Error al actualizar el cliente', 'error');
        } finally {
            mostrarCargando(false);
        }
    }

    function cerrarModalDetalle() {
        document.getElementById('modalDetalleCliente').classList.add('hidden');
        document.getElementById('modalDetalleCliente').classList.remove('flex');
    }

    function cerrarModalEditar() {
        document.getElementById('modalEditarCliente').classList.add('hidden');
        document.getElementById('modalEditarCliente').classList.remove('flex');
    }

    function mostrarCargando(mostrar) {
        document.getElementById('loader').classList.toggle('hidden', !mostrar);
    }

    function mostrarToast(mensaje, tipo = 'info') {
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toastMessage');
        const colores = {
            success: 'bg-green-500',
            error: 'bg-red-500',
            info: 'bg-blue-500'
        };
        toast.className = `fixed bottom-4 right-4 px-6 py-3 rounded-lg shadow-lg text-white z-50 ${colores[tipo]}`;
        toastMessage.textContent = mensaje;
        toast.classList.remove('hidden');
        setTimeout(() => toast.classList.add('hidden'), 3000);
    }

    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            cerrarModalDetalle();
            cerrarModalEditar();
        }
    });
</script>
</body>

</html>