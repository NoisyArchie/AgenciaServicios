<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <title>Agregar Vehículo - Siscare</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />
</head>

<body class="bg-[#0D0D0D] text-white min-h-screen flex">
<!-- SIDEBAR -->
<aside class="w-64 bg-black/80 border-r border-orange-600/20 flex flex-col justify-between py-6 px-4">
    <div>
        <h2 class="text-3xl font-bold text-orange-500 border-b border-gray-700 pb-2 mb-6 text-center">
            Siscare
        </h2>

        <nav class="flex flex-col gap-1">
            <a href="/trabajador/panelTrabajador.html" class="flex items-center gap-3 p-3 rounded hover:bg-orange-500/20 transition">
                <i class="bx bx-home text-xl"></i> Panel
            </a>

            <a href="/trabajador/servicios.html" class="flex items-center gap-3 p-3 rounded hover:bg-orange-500/20 transition">
                <i class="bx bx-wrench text-xl"></i> Servicios
            </a>

            <a href="/trabajador/clientes.html" class="flex items-center gap-3 p-3 rounded hover:bg-orange-500/20 transition">
                <i class="bx bx-user text-xl"></i> Clientes
            </a>
        </nav>
    </div>

    <div class="border-t border-gray-700 pt-4">
        <button onclick="cerrarSesion()" class="w-full flex items-center gap-3 p-3 hover:bg-red-500/30 rounded transition text-red-400">
            <i class="bx bx-log-out text-xl"></i> Cerrar Sesión
        </button>
    </div>
</aside>

<!-- CONTENIDO PRINCIPAL -->
<main class="flex-1 flex flex-col">
    <!-- NAVBAR SUPERIOR -->
    <header class="flex justify-between items-center px-8 py-4 border-b border-gray-800 bg-[#111]/80 backdrop-blur-sm">
        <!-- Icono de usuario -->
        <div class="flex items-center gap-3">
            <span id="usuarioNombre" class="text-gray-300 text-sm">Trabajador</span>
            <button class="bg-orange-600 hover:bg-orange-500 p-2 rounded-full transition">
                <i class="bx bx-user text-white text-xl"></i>
            </button>
        </div>
    </header>

    <!-- CONTENIDO -->
    <section class="p-8 flex-1 overflow-y-auto">
        <div class="max-w-4xl mx-auto">
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h1 class="text-3xl font-bold">Agregar Vehículo a Cliente</h1>
                    <p class="text-gray-400 text-sm">
                        Registra un nuevo vehículo para un cliente existente
                    </p>
                </div>

                <a href="/trabajador/clientes.html"
                   class="flex items-center gap-2 bg-gray-700 hover:bg-gray-600 transition px-4 py-2 rounded shadow">
                    <i class="bx bx-arrow-back"></i> Volver a Clientes
                </a>
            </div>

            <!-- Formulario de Alta de Vehículo -->
            <div class="bg-[#1A1A1A] p-6 rounded-xl border border-gray-700">
                <form id="formAltaVehiculo" class="space-y-8">
                    <!-- Sección 1: Selección de Cliente -->
                    <div>
                        <h2 class="text-xl font-bold text-orange-400 mb-4 flex items-center gap-2">
                            <i class="bx bx-user"></i>
                            Seleccionar Cliente
                        </h2>

                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">
                                Cliente *
                            </label>
                            <select id="selectCliente" required
                                    class="w-full bg-black/30 border border-gray-700 text-white p-3 rounded-lg focus:border-orange-500 transition">
                                <option value="">Selecciona un cliente...</option>
                            </select>
                        </div>

                        <!-- Información del Cliente Seleccionado -->
                        <div id="infoCliente" class="hidden mt-4 bg-black/30 p-4 rounded-lg border border-gray-600">
                            <h3 class="text-lg font-semibold text-orange-400 mb-2">Información del Cliente</h3>
                            <div class="grid grid-cols-2 gap-4 text-sm">
                                <div>
                                    <span class="text-gray-400">Nombre:</span>
                                    <span id="clienteNombre" class="font-medium block">-</span>
                                </div>
                                <div>
                                    <span class="text-gray-400">Teléfono:</span>
                                    <span id="clienteTelefono" class="block">-</span>
                                </div>
                                <div>
                                    <span class="text-gray-400">Email:</span>
                                    <span id="clienteEmail" class="block">-</span>
                                </div>
                                <div>
                                    <span class="text-gray-400">Vehículos actuales:</span>
                                    <span id="clienteVehiculos" class="block">-</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sección 2: Información del Vehículo -->
                    <div>
                        <h2 class="text-xl font-bold text-orange-400 mb-4 flex items-center gap-2">
                            <i class="bx bx-car"></i>
                            Información del Vehículo
                        </h2>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">
                                    Marca *
                                </label>
                                <select id="selectMarca" required
                                        class="w-full bg-black/30 border border-gray-700 text-white p-3 rounded-lg focus:border-orange-500 transition">
                                    <option value="">Selecciona una marca</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">
                                    Modelo *
                                </label>
                                <select id="selectModelo" required
                                        class="w-full bg-black/30 border border-gray-700 text-white p-3 rounded-lg focus:border-orange-500 transition">
                                    <option value="">Primero selecciona una marca</option>
                                </select>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">
                                    Año *
                                </label>
                                <input type="number" id="inputAnio" required min="1990" max="2025"
                                       class="w-full bg-black/30 border border-gray-700 text-white p-3 rounded-lg focus:border-orange-500 transition"
                                       placeholder="Ej: 2022">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">
                                    Color *
                                </label>
                                <input type="text" id="inputColor" required
                                       class="w-full bg-black/30 border border-gray-700 text-white p-3 rounded-lg focus:border-orange-500 transition"
                                       placeholder="Color del vehículo">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">
                                    Kilometraje Actual *
                                </label>
                                <input type="number" id="inputKilometraje" required min="0"
                                       class="w-full bg-black/30 border border-gray-700 text-white p-3 rounded-lg focus:border-orange-500 transition"
                                       placeholder="Ej: 45000">
                            </div>
                        </div>
                    </div>

                    <!-- Sección 3: Información de Identificación -->
                    <div>
                        <h2 class="text-xl font-bold text-orange-400 mb-4 flex items-center gap-2">
                            <i class="bx bx-id-card"></i>
                            Información de Identificación
                        </h2>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">
                                    Número de Serie *
                                </label>
                                <input type="text" id="inputNumeroSerie" required
                                       class="w-full bg-black/30 border border-gray-700 text-white p-3 rounded-lg focus:border-orange-500 transition"
                                       placeholder="Número de serie del vehículo">
                                <p class="mt-1 text-xs text-gray-400">
                                    Identificación única del vehículo
                                </p>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">
                                    Placas *
                                </label>
                                <input type="text" id="inputPlacas" required
                                       class="w-full bg-black/30 border border-gray-700 text-white p-3 rounded-lg focus:border-orange-500 transition"
                                       placeholder="Ej: ABC-1234">
                                <p class="mt-1 text-xs text-gray-400">
                                    Placas de circulación
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Resumen del Vehículo -->
                    <div class="bg-black/30 p-4 rounded-lg border border-gray-600">
                        <h3 class="text-lg font-semibold text-orange-400 mb-3">Resumen del Vehículo</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                            <div>
                                <p class="text-gray-400">Cliente:</p>
                                <p id="resumenCliente" class="font-medium">-</p>
                            </div>
                            <div>
                                <p class="text-gray-400">Vehículo:</p>
                                <p id="resumenVehiculo" class="font-medium">-</p>
                            </div>
                            <div>
                                <p class="text-gray-400">Año:</p>
                                <p id="resumenAnio" class="font-medium">-</p>
                            </div>
                            <div>
                                <p class="text-gray-400">Color:</p>
                                <p id="resumenColor" class="font-medium">-</p>
                            </div>
                            <div>
                                <p class="text-gray-400">Placas:</p>
                                <p id="resumenPlacas" class="font-medium">-</p>
                            </div>
                            <div>
                                <p class="text-gray-400">Kilometraje:</p>
                                <p id="resumenKilometraje" class="font-medium">-</p>
                            </div>
                        </div>
                    </div>

                    <!-- Botones de Acción -->
                    <div class="flex justify-end gap-4 pt-6 border-t border-gray-700">
                        <a href="/trabajador/clientes.html"
                           class="px-8 py-3 bg-gray-700 hover:bg-gray-600 rounded-lg font-medium transition">
                            Cancelar
                        </a>
                        <button type="submit"
                                class="px-8 py-3 bg-orange-600 hover:bg-orange-500 rounded-lg font-medium transition flex items-center gap-2">
                            <i class="bx bx-save"></i>
                            Registrar Vehículo
                        </button>
                    </div>
                </form>
            </div>

            <!-- Información Adicional -->
            <div class="mt-6 bg-[#1A1A1A] p-4 rounded-xl border border-gray-700">
                <h3 class="text-lg font-semibold text-orange-400 mb-3">Información Importante</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                    <div class="p-3 bg-blue-500/10 border border-blue-500/20 rounded-lg">
                        <h4 class="font-medium text-blue-400 mb-1">Identificación Única</h4>
                        <p class="text-gray-400">El número de serie debe ser único para cada vehículo en el sistema.</p>
                    </div>
                    <div class="p-3 bg-green-500/10 border border-green-500/20 rounded-lg">
                        <h4 class="font-medium text-green-400 mb-1">Servicios Futuros</h4>
                        <p class="text-gray-400">Este vehículo podrá recibir servicios en el taller una vez registrado.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>
</main>

<!-- Modal de Confirmación -->
<div id="modalConfirmacion" class="fixed inset-0 bg-black/70 backdrop-blur-md hidden justify-center items-center z-50">
    <div class="bg-[#1A1A1A]/95 p-8 rounded-2xl shadow-xl border border-orange-500/30 w-[500px] animate-[zoomIn_.3s_ease]">
        <div class="text-center">
            <div class="w-16 h-16 bg-green-500/20 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="bx bx-check text-green-400 text-2xl"></i>
            </div>
            <h3 class="text-xl font-bold text-white mb-2">¡Vehículo Registrado!</h3>
            <p class="text-gray-400 mb-4">El vehículo ha sido registrado exitosamente para el cliente.</p>

            <div class="bg-black/30 p-4 rounded-lg border border-gray-700 mb-6 text-left">
                <h4 class="font-semibold text-orange-400 mb-2">Resumen del Registro:</h4>
                <div class="space-y-2 text-sm">
                    <div class="flex justify-between">
                        <span class="text-gray-400">Cliente:</span>
                        <span id="confirmacionCliente">-</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Vehículo:</span>
                        <span id="confirmacionVehiculo">-</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Placas:</span>
                        <span id="confirmacionPlacas" class="font-mono">-</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Número de Serie:</span>
                        <span id="confirmacionSerie" class="font-mono">-</span>
                    </div>
                </div>
            </div>

            <div class="flex gap-3 justify-center">
                <button onclick="cerrarModalConfirmacion()"
                        class="px-6 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg transition">
                    Agregar Otro Vehículo
                </button>
                <a href="/trabajador/clientes.html"
                   class="px-6 py-2 bg-orange-600 hover:bg-orange-500 rounded-lg transition">
                    Ver Lista de Clientes
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Loader -->
<div id="loader" class="hidden fixed inset-0 bg-black/70 backdrop-blur-md flex justify-center items-center z-50">
    <div class="bg-[#1A1A1A] p-8 rounded-2xl shadow-xl border border-orange-500/30">
        <div class="flex flex-col items-center gap-4">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-orange-600"></div>
            <p class="text-gray-300">Guardando vehículo...</p>
        </div>
    </div>
</div>

<!-- Toast -->
<div id="toast" class="hidden fixed bottom-4 right-4 px-6 py-3 rounded-lg shadow-lg text-white z-50">
    <p id="toastMessage"></p>
</div>

<style>
    @keyframes zoomIn {
        0% {
            opacity: 0;
            transform: scale(0.85);
        }
        100% {
            opacity: 1;
            transform: scale(1);
        }
    }

    input:focus, select:focus, textarea:focus {
        outline: none;
        box-shadow: 0 0 0 2px rgba(255, 140, 0, 0.2);
    }
</style>

<script>
    const API_URL_CLIENTES = 'http://localhost:8080/api/clientes';
    const API_URL_MARCAS = 'http://localhost:8080/api/marcas';
    const API_URL_MODELOS = 'http://localhost:8080/api/modelos';
    const API_URL_VEHICULOS = 'http://localhost:8080/api/vehiculos';

    let clientes = [];
    let marcas = [];

    // Inicializar la página
    document.addEventListener('DOMContentLoaded', function() {
        verificarSesion();
        cargarClientes();
        cargarMarcas();
        configurarEventos();
        actualizarResumen();
    });

    function verificarSesion() {
        const usuario = sessionStorage.getItem('usuario');
        if (!usuario) {
            window.location.href = '../login.html';
            return;
        }
        const userData = JSON.parse(usuario);
        document.getElementById('usuarioNombre').textContent = userData.nombreUsuario || 'Trabajador';
    }

    function cerrarSesion() {
        if (confirm('¿Está seguro de cerrar sesión?')) {
            sessionStorage.clear();
            localStorage.clear();
            window.location.href = '../login.html';
        }
    }

    // Cargar clientes desde la API
    async function cargarClientes() {
        try {
            const response = await fetch(API_URL_CLIENTES);
            if (!response.ok) throw new Error('Error al cargar clientes');

            clientes = await response.json();
            const select = document.getElementById('selectCliente');
            select.innerHTML = '<option value="">Selecciona un cliente...</option>';

            clientes.forEach(cliente => {
                const option = document.createElement('option');
                option.value = cliente.idCliente;
                option.textContent = `${cliente.nombreCompleto} - ${cliente.email || cliente.telefono}`;
                option.dataset.cliente = JSON.stringify(cliente);
                select.appendChild(option);
            });
        } catch (error) {
            console.error('Error:', error);
            mostrarToast('Error al cargar clientes', 'error');
        }
    }

    // Cargar marcas desde la API
    // En la función cargarMarcas
    async function cargarMarcas() {
        try {
            console.log('Cargando marcas desde:', API_URL_MARCAS);
            const response = await fetch(API_URL_MARCAS);
            console.log('Response marcas:', response.status);

            if (!response.ok) throw new Error('Error al cargar marcas');

            marcas = await response.json();
            console.log('Marcas cargadas:', marcas); // <-- IMPORTANTE

            const select = document.getElementById('selectMarca');
            select.innerHTML = '<option value="">Selecciona una marca</option>';

            marcas.forEach(marca => {
                const option = document.createElement('option');
                option.value = marca.idMarca;
                option.textContent = marca.nombreMarca;
                select.appendChild(option);
            });

            console.log('Total marcas agregadas:', marcas.length);
        } catch (error) {
            console.error('Error completo:', error);
            mostrarToast('Error al cargar marcas: ' + error.message, 'error');
        }
    }

    // En la función cargarModelos
    async function cargarModelos(marcaId) {
        const selectModelo = document.getElementById('selectModelo');
        selectModelo.innerHTML = '<option value="">Cargando modelos...</option>';

        if (!marcaId) {
            selectModelo.innerHTML = '<option value="">Primero selecciona una marca</option>';
            return;
        }

        try {
            console.log('Cargando modelos para marca:', marcaId);
            const response = await fetch(`${API_URL_MODELOS}/marca/${marcaId}`);
            console.log('Response modelos:', response.status);

            if (!response.ok) throw new Error('Error al cargar modelos');

            const modelos = await response.json();
            console.log('Modelos cargados:', modelos); // <-- IMPORTANTE

            selectModelo.innerHTML = '<option value="">Selecciona un modelo</option>';

            modelos.forEach(modelo => {
                const option = document.createElement('option');
                option.value = modelo.idModelo;
                option.textContent = modelo.nombreModelo;
                selectModelo.appendChild(option);
            });

            console.log('Total modelos agregados:', modelos.length);
        } catch (error) {
            console.error('Error completo:', error);
            selectModelo.innerHTML = '<option value="">Error al cargar modelos</option>';
            mostrarToast('Error al cargar modelos: ' + error.message, 'error');
        }
    }

    // Configurar eventos
    function configurarEventos() {
        // Cambio en selección de cliente
        document.getElementById('selectCliente').addEventListener('change', function() {
            const option = this.options[this.selectedIndex];
            if (option.dataset.cliente) {
                const cliente = JSON.parse(option.dataset.cliente);
                actualizarInfoCliente(cliente);
            } else {
                document.getElementById('infoCliente').classList.add('hidden');
            }
            actualizarResumen();
        });

        // Cambio en selección de marca
        document.getElementById('selectMarca').addEventListener('change', function() {
            cargarModelos(this.value);
            actualizarResumen();
        });

        // Actualizar resumen en tiempo real
        document.getElementById('selectModelo').addEventListener('change', actualizarResumen);
        document.getElementById('inputAnio').addEventListener('input', actualizarResumen);
        document.getElementById('inputColor').addEventListener('input', actualizarResumen);
        document.getElementById('inputKilometraje').addEventListener('input', actualizarResumen);
        document.getElementById('inputNumeroSerie').addEventListener('input', actualizarResumen);
        document.getElementById('inputPlacas').addEventListener('input', actualizarResumen);

        // Formulario de alta
        document.getElementById('formAltaVehiculo').addEventListener('submit', function(e) {
            e.preventDefault();
            registrarVehiculo();
        });
    }

    // Actualizar información del cliente seleccionado
    function actualizarInfoCliente(cliente) {
        document.getElementById('clienteNombre').textContent = cliente.nombreCompleto;
        document.getElementById('clienteTelefono').textContent = cliente.telefono || 'N/A';
        document.getElementById('clienteEmail').textContent = cliente.email || 'N/A';
        document.getElementById('clienteVehiculos').textContent = '0 vehículo(s)'; // TODO: Obtener del backend
        document.getElementById('infoCliente').classList.remove('hidden');
    }

    // Actualizar resumen en tiempo real
    function actualizarResumen() {
        const clienteSelect = document.getElementById('selectCliente');
        const clienteNombre = clienteSelect.options[clienteSelect.selectedIndex]?.text.split(' - ')[0] || '-';

        const marcaSelect = document.getElementById('selectMarca');
        const marca = marcaSelect.options[marcaSelect.selectedIndex]?.text || '-';

        const modeloSelect = document.getElementById('selectModelo');
        const modelo = modeloSelect.options[modeloSelect.selectedIndex]?.text || '-';

        const anio = document.getElementById('inputAnio').value || '-';
        const color = document.getElementById('inputColor').value || '-';
        const kilometraje = document.getElementById('inputKilometraje').value || '-';
        const placas = document.getElementById('inputPlacas').value || '-';

        document.getElementById('resumenCliente').textContent = clienteNombre;
        document.getElementById('resumenVehiculo').textContent = `${marca} ${modelo}`;
        document.getElementById('resumenAnio').textContent = anio;
        document.getElementById('resumenColor').textContent = color;
        document.getElementById('resumenPlacas').textContent = placas;
        document.getElementById('resumenKilometraje').textContent = kilometraje !== '-' ? kilometraje + ' km' : '-';
    }

    // Validar formulario
    function validarFormulario() {
        const cliente = document.getElementById('selectCliente').value;
        const marca = document.getElementById('selectMarca').value;
        const modelo = document.getElementById('selectModelo').value;
        const anio = document.getElementById('inputAnio').value;
        const color = document.getElementById('inputColor').value;
        const kilometraje = document.getElementById('inputKilometraje').value;
        const numeroSerie = document.getElementById('inputNumeroSerie').value;
        const placas = document.getElementById('inputPlacas').value;

        if (!cliente) {
            mostrarToast('Por favor selecciona un cliente', 'error');
            return false;
        }

        if (!marca) {
            mostrarToast('Por favor selecciona una marca', 'error');
            return false;
        }

        if (!modelo) {
            mostrarToast('Por favor selecciona un modelo', 'error');
            return false;
        }

        if (!anio) {
            mostrarToast('Por favor ingresa el año del vehículo', 'error');
            return false;
        }

        if (anio < 1990 || anio > 2025) {
            mostrarToast('Por favor ingresa un año válido (1990-2025)', 'error');
            return false;
        }

        if (!color) {
            mostrarToast('Por favor ingresa el color del vehículo', 'error');
            return false;
        }

        if (!kilometraje) {
            mostrarToast('Por favor ingresa el kilometraje actual', 'error');
            return false;
        }

        if (kilometraje < 0) {
            mostrarToast('El kilometraje no puede ser negativo', 'error');
            return false;
        }

        if (!numeroSerie) {
            mostrarToast('Por favor ingresa el número de serie (VIN)', 'error');
            return false;
        }

        if (!placas) {
            mostrarToast('Por favor ingresa las placas del vehículo', 'error');
            return false;
        }

        return true;
    }

    // Registrar vehículo
    async function registrarVehiculo() {
        if (!validarFormulario()) {
            return;
        }

        const vehiculoData = {
            cliente: {
                idCliente: parseInt(document.getElementById('selectCliente').value)
            },
            modelo: {
                idModelo: parseInt(document.getElementById('selectModelo').value)
            },
            anio: parseInt(document.getElementById('inputAnio').value),
            color: document.getElementById('inputColor').value.trim(),
            kilometraje: parseInt(document.getElementById('inputKilometraje').value),
            numeroSerie: document.getElementById('inputNumeroSerie').value.trim(),
            placas: document.getElementById('inputPlacas').value.trim()
        };

        try {
            mostrarCargando(true);

            const response = await fetch(API_URL_VEHICULOS, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(vehiculoData)
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.message || 'Error al guardar el vehículo');
            }

            const vehiculoGuardado = await response.json();
            console.log('Vehículo guardado:', vehiculoGuardado);

            // Preparar datos para el modal
            const clienteSelect = document.getElementById('selectCliente');
            const marcaSelect = document.getElementById('selectMarca');
            const modeloSelect = document.getElementById('selectModelo');

            mostrarModalConfirmacion({
                cliente_nombre: clienteSelect.options[clienteSelect.selectedIndex].text.split(' - ')[0],
                marca_nombre: marcaSelect.options[marcaSelect.selectedIndex].text,
                modelo_nombre: modeloSelect.options[modeloSelect.selectedIndex].text,
                anio: vehiculoData.anio,
                placas: vehiculoData.placas,
                numero_serie: vehiculoData.numeroSerie
            });

            mostrarToast('Vehículo registrado correctamente', 'success');

        } catch (error) {
            console.error('Error:', error);
            mostrarToast(error.message, 'error');
        } finally {
            mostrarCargando(false);
        }
    }

    // Mostrar modal de confirmación
    function mostrarModalConfirmacion(data) {
        document.getElementById('confirmacionCliente').textContent = data.cliente_nombre;
        document.getElementById('confirmacionVehiculo').textContent = `${data.marca_nombre} ${data.modelo_nombre} ${data.anio}`;
        document.getElementById('confirmacionPlacas').textContent = data.placas;
        document.getElementById('confirmacionSerie').textContent = data.numero_serie;

        document.getElementById('modalConfirmacion').classList.remove('hidden');
        document.getElementById('modalConfirmacion').classList.add('flex');
    }

    // Cerrar modal de confirmación
    function cerrarModalConfirmacion() {
        document.getElementById('modalConfirmacion').classList.add('hidden');
        document.getElementById('modalConfirmacion').classList.remove('flex');

        // Limpiar formulario
        document.getElementById('formAltaVehiculo').reset();
        document.getElementById('infoCliente').classList.add('hidden');
        document.getElementById('selectModelo').innerHTML = '<option value="">Primero selecciona una marca</option>';
        actualizarResumen();
    }

    function mostrarCargando(mostrar) {
        document.getElementById('loader').classList.toggle('hidden', !mostrar);
    }

    function mostrarToast(mensaje, tipo = 'info') {
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toastMessage');
        const colores = {
            success: 'bg-green-500',
            error: 'bg-red-500',
            info: 'bg-blue-500'
        };
        toast.className = `fixed bottom-4 right-4 px-6 py-3 rounded-lg shadow-lg text-white z-50 ${colores[tipo]}`;
        toastMessage.textContent = mensaje;
        toast.classList.remove('hidden');
        setTimeout(() => toast.classList.add('hidden'), 3000);
    }

    // Cerrar modal con ESC
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            cerrarModalConfirmacion();
        }
    });
</script>
</body>

</html>