<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8" />
    <title>Agregar Vehículo - Siscare</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />
</head>

<body class="bg-[#0D0D0D] text-white min-h-screen flex">
    <!-- SIDEBAR -->
    <aside class="w-64 bg-black/80 border-r border-orange-600/20 flex flex-col justify-between py-6 px-4">
        <div>
            <h2 class="text-3xl font-bold text-orange-500 border-b border-gray-700 pb-2 mb-6 text-center">
                Siscare
            </h2>

            <nav class="flex flex-col gap-1">
                <a href="/trabajador/panelTrabajador.html" class="flex items-center gap-3 p-3 rounded hover:bg-orange-500/20 transition">
                    <i class="bx bx-home text-xl"></i> Panel
                </a>

                <a href="/trabajador/servicios.html" class="flex items-center gap-3 p-3 rounded hover:bg-orange-500/20 transition">
                    <i class="bx bx-wrench text-xl"></i> Servicios
                </a>

                <a href="/trabajador/clientes.html" class="flex items-center gap-3 p-3 rounded hover:bg-orange-500/20 transition">
                    <i class="bx bx-user text-xl"></i> Clientes
                </a>
            </nav>
        </div>

        <div class="border-t border-gray-700 pt-4">
            <a href="#" class="flex items-center gap-3 p-3 hover:bg-red-500/30 rounded transition text-red-400">
                <i class="bx bx-log-out text-xl"></i> Cerrar Sesión
            </a>
        </div>
    </aside>

    <!-- CONTENIDO PRINCIPAL -->
    <main class="flex-1 flex flex-col">
        <!-- NAVBAR SUPERIOR -->
        <header class="flex justify-between items-center px-8 py-4 border-b border-gray-800 bg-[#111]/80 backdrop-blur-sm">
            <!-- Icono de usuario -->
            <div class="flex items-center gap-3">
                <span class="text-gray-300 text-sm">Trabajador</span>
                <button class="bg-orange-600 hover:bg-orange-500 p-2 rounded-full transition">
                    <i class="bx bx-user text-white text-xl"></i>
                </button>
            </div>
        </header>

        <!-- CONTENIDO -->
        <section class="p-8 flex-1 overflow-y-auto">
            <div class="max-w-4xl mx-auto">
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h1 class="text-3xl font-bold">Agregar Vehículo a Cliente</h1>
                        <p class="text-gray-400 text-sm">
                            Registra un nuevo vehículo para un cliente existente
                        </p>
                    </div>

                    <a href="/trabajador/clientes.html"
                        class="flex items-center gap-2 bg-gray-700 hover:bg-gray-600 transition px-4 py-2 rounded shadow">
                        <i class="bx bx-arrow-back"></i> Volver a Clientes
                    </a>
                </div>

                <!-- Formulario de Alta de Vehículo -->
                <div class="bg-[#1A1A1A] p-6 rounded-xl border border-gray-700">
                    <form id="formAltaVehiculo" class="space-y-8">
                        <!-- Sección 1: Selección de Cliente -->
                        <div>
                            <h2 class="text-xl font-bold text-orange-400 mb-4 flex items-center gap-2">
                                <i class="bx bx-user"></i>
                                Seleccionar Cliente
                            </h2>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">
                                    Cliente *
                                </label>
                                <select id="selectCliente" required
                                    class="w-full bg-black/30 border border-gray-700 text-white p-3 rounded-lg focus:border-orange-500 transition">
                                    <option value="">Selecciona un cliente...</option>
                                    <option value="1">Juan Pérez García - juan@email.com</option>
                                    <option value="2">María López Hernández - maria@email.com</option>
                                    <option value="3">Carlos Rodríguez - carlos@email.com</option>
                                    <option value="4">Ana Martínez - ana@email.com</option>
                                </select>
                            </div>

                            <!-- Información del Cliente Seleccionado -->
                            <div id="infoCliente" class="hidden mt-4 bg-black/30 p-4 rounded-lg border border-gray-600">
                                <h3 class="text-lg font-semibold text-orange-400 mb-2">Información del Cliente</h3>
                                <div class="grid grid-cols-2 gap-4 text-sm">
                                    <div>
                                        <span class="text-gray-400">Nombre:</span>
                                        <span id="clienteNombre" class="font-medium block">-</span>
                                    </div>
                                    <div>
                                        <span class="text-gray-400">Teléfono:</span>
                                        <span id="clienteTelefono" class="block">-</span>
                                    </div>
                                    <div>
                                        <span class="text-gray-400">Email:</span>
                                        <span id="clienteEmail" class="block">-</span>
                                    </div>
                                    <div>
                                        <span class="text-gray-400">Vehículos actuales:</span>
                                        <span id="clienteVehiculos" class="block">-</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Sección 2: Información del Vehículo -->
                        <div>
                            <h2 class="text-xl font-bold text-orange-400 mb-4 flex items-center gap-2">
                                <i class="bx bx-car"></i>
                                Información del Vehículo
                            </h2>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">
                                        Marca *
                                    </label>
                                    <select id="selectMarca" required
                                        class="w-full bg-black/30 border border-gray-700 text-white p-3 rounded-lg focus:border-orange-500 transition">
                                        <option value="">Selecciona una marca</option>
                                        <option value="1">Toyota</option>
                                        <option value="2">Honda</option>
                                        <option value="3">Nissan</option>
                                        <option value="4">Ford</option>
                                        <option value="5">Chevrolet</option>
                                        <option value="6">Volkswagen</option>
                                        <option value="7">Mazda</option>
                                        <option value="8">Hyundai</option>
                                    </select>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">
                                        Modelo *
                                    </label>
                                    <select id="selectModelo" required
                                        class="w-full bg-black/30 border border-gray-700 text-white p-3 rounded-lg focus:border-orange-500 transition">
                                        <option value="">Primero selecciona una marca</option>
                                    </select>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">
                                        Año *
                                    </label>
                                    <input type="number" id="inputAnio" required min="1990" max="2024"
                                        class="w-full bg-black/30 border border-gray-700 text-white p-3 rounded-lg focus:border-orange-500 transition"
                                        placeholder="Ej: 2022">
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">
                                        Color *
                                    </label>
                                    <input type="text" id="inputColor" required
                                        class="w-full bg-black/30 border border-gray-700 text-white p-3 rounded-lg focus:border-orange-500 transition"
                                        placeholder="Color del vehículo">
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">
                                        Kilometraje Actual *
                                    </label>
                                    <input type="number" id="inputKilometraje" required min="0"
                                        class="w-full bg-black/30 border border-gray-700 text-white p-3 rounded-lg focus:border-orange-500 transition"
                                        placeholder="Ej: 45000">
                                </div>
                            </div>
                        </div>

                        <!-- Sección 3: Información de Identificación -->
                        <div>
                            <h2 class="text-xl font-bold text-orange-400 mb-4 flex items-center gap-2">
                                <i class="bx bx-id-card"></i>
                                Información de Identificación
                            </h2>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">
                                        Número de Serie *
                                    </label>
                                    <input type="text" id="inputNumeroSerie" required
                                        class="w-full bg-black/30 border border-gray-700 text-white p-3 rounded-lg focus:border-orange-500 transition"
                                        placeholder="Número de serie del vehículo">
                                    <p class="mt-1 text-xs text-gray-400">
                                        Identificación única del vehículo
                                    </p>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">
                                        Placas *
                                    </label>
                                    <input type="text" id="inputPlacas" required
                                        class="w-full bg-black/30 border border-gray-700 text-white p-3 rounded-lg focus:border-orange-500 transition"
                                        placeholder="Ej: ABC-1234">
                                    <p class="mt-1 text-xs text-gray-400">
                                        Placas de circulación
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- Resumen del Vehículo -->
                        <div class="bg-black/30 p-4 rounded-lg border border-gray-600">
                            <h3 class="text-lg font-semibold text-orange-400 mb-3">Resumen del Vehículo</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                <div>
                                    <p class="text-gray-400">Cliente:</p>
                                    <p id="resumenCliente" class="font-medium">-</p>
                                </div>
                                <div>
                                    <p class="text-gray-400">Vehículo:</p>
                                    <p id="resumenVehiculo" class="font-medium">-</p>
                                </div>
                                <div>
                                    <p class="text-gray-400">Año:</p>
                                    <p id="resumenAnio" class="font-medium">-</p>
                                </div>
                                <div>
                                    <p class="text-gray-400">Color:</p>
                                    <p id="resumenColor" class="font-medium">-</p>
                                </div>
                                <div>
                                    <p class="text-gray-400">Placas:</p>
                                    <p id="resumenPlacas" class="font-medium">-</p>
                                </div>
                                <div>
                                    <p class="text-gray-400">Kilometraje:</p>
                                    <p id="resumenKilometraje" class="font-medium">-</p>
                                </div>
                            </div>
                        </div>

                        <!-- Botones de Acción -->
                        <div class="flex justify-end gap-4 pt-6 border-t border-gray-700">
                            <a href="/trabajador/clientes.html" 
                               class="px-8 py-3 bg-gray-700 hover:bg-gray-600 rounded-lg font-medium transition">
                                Cancelar
                            </a>
                            <button type="submit"
                                class="px-8 py-3 bg-orange-600 hover:bg-orange-500 rounded-lg font-medium transition flex items-center gap-2">
                                <i class="bx bx-save"></i>
                                Registrar Vehículo
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Información Adicional -->
                <div class="mt-6 bg-[#1A1A1A] p-4 rounded-xl border border-gray-700">
                    <h3 class="text-lg font-semibold text-orange-400 mb-3">Información Importante</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                        <div class="p-3 bg-blue-500/10 border border-blue-500/20 rounded-lg">
                            <h4 class="font-medium text-blue-400 mb-1">Identificación Única</h4>
                            <p class="text-gray-400">El número de serie debe ser único para cada vehículo en el sistema.</p>
                        </div>
                        <div class="p-3 bg-green-500/10 border border-green-500/20 rounded-lg">
                            <h4 class="font-medium text-green-400 mb-1">Servicios Futuros</h4>
                            <p class="text-gray-400">Este vehículo podrá recibir servicios en el taller una vez registrado.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Modal de Confirmación -->
    <div id="modalConfirmacion" class="fixed inset-0 bg-black/70 backdrop-blur-md hidden justify-center items-center z-50">
        <div class="bg-[#1A1A1A]/95 p-8 rounded-2xl shadow-xl border border-orange-500/30 w-[500px] animate-[zoomIn_.3s_ease]">
            <div class="text-center">
                <div class="w-16 h-16 bg-green-500/20 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="bx bx-check text-green-400 text-2xl"></i>
                </div>
                <h3 class="text-xl font-bold text-white mb-2">¡Vehículo Registrado!</h3>
                <p class="text-gray-400 mb-4">El vehículo ha sido registrado exitosamente para el cliente.</p>
                
                <div class="bg-black/30 p-4 rounded-lg border border-gray-700 mb-6 text-left">
                    <h4 class="font-semibold text-orange-400 mb-2">Resumen del Registro:</h4>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span class="text-gray-400">Cliente:</span>
                            <span id="confirmacionCliente">Juan Pérez García</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">Vehículo:</span>
                            <span id="confirmacionVehiculo">Toyota Corolla 2022</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">Placas:</span>
                            <span id="confirmacionPlacas" class="font-mono">ABC-1234</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">Número de Serie:</span>
                            <span id="confirmacionSerie" class="font-mono">1HGCM82633A123456</span>
                        </div>
                    </div>
                </div>

                <div class="flex gap-3 justify-center">
                    <button onclick="cerrarModalConfirmacion()" 
                            class="px-6 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg transition">
                        Agregar Otro Vehículo
                    </button>
                    <a href="/trabajador/clientes.html" 
                       class="px-6 py-2 bg-orange-600 hover:bg-orange-500 rounded-lg transition">
                        Ver Lista de Clientes
                    </a>
                </div>
            </div>
        </div>
    </div>

    <style>
        @keyframes zoomIn {
            0% {
                opacity: 0;
                transform: scale(0.85);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            box-shadow: 0 0 0 2px rgba(255, 140, 0, 0.2);
        }
    </style>

    <script>
        // Datos de ejemplo
        const clientes = {
            '1': {
                nombre: 'Juan Pérez García',
                telefono: '+52 555 123 4567',
                email: 'juan@email.com',
                vehiculos: 2
            },
            '2': {
                nombre: 'María López Hernández',
                telefono: '+52 555 987 6543',
                email: 'maria@email.com',
                vehiculos: 1
            },
            '3': {
                nombre: 'Carlos Rodríguez',
                telefono: '+52 555 456 7890',
                email: 'carlos@email.com',
                vehiculos: 1
            },
            '4': {
                nombre: 'Ana Martínez',
                telefono: '+52 555 234 5678',
                email: 'ana@email.com',
                vehiculos: 0
            }
        };

        const modelosPorMarca = {
            '1': ['Corolla', 'Camry', 'RAV4', 'Hilux', 'Yaris', 'Prius'],
            '2': ['Civic', 'Accord', 'CR-V', 'HR-V', 'Pilot', 'Fit'],
            '3': ['Sentra', 'Versa', 'Altima', 'Kicks', 'X-Trail', 'March'],
            '4': ['Focus', 'Fiesta', 'Escape', 'Ranger', 'Mustang', 'Explorer'],
            '5': ['Aveo', 'Spark', 'Cruze', 'Tracker', 'Equinox', 'Malibu'],
            '6': ['Jetta', 'Golf', 'Tiguan', 'Vento', 'Polo', 'T-Cross'],
            '7': ['Mazda3', 'Mazda6', 'CX-5', 'CX-30', 'CX-9', 'MX-5'],
            '8': ['Elantra', 'Tucson', 'Santa Fe', 'Accent', 'Creta', 'Kona']
        };

        // Inicializar la página
        document.addEventListener('DOMContentLoaded', function() {
            configurarEventos();
            actualizarResumen();
        });

        // Configurar eventos
        function configurarEventos() {
            // Cambio en selección de cliente
            document.getElementById('selectCliente').addEventListener('change', function() {
                actualizarInfoCliente(this.value);
                actualizarResumen();
            });

            // Cambio en selección de marca
            document.getElementById('selectMarca').addEventListener('change', function() {
                cargarModelos(this.value);
                actualizarResumen();
            });

            // Actualizar resumen en tiempo real
            document.getElementById('selectModelo').addEventListener('change', actualizarResumen);
            document.getElementById('inputAnio').addEventListener('input', actualizarResumen);
            document.getElementById('inputColor').addEventListener('input', actualizarResumen);
            document.getElementById('inputKilometraje').addEventListener('input', actualizarResumen);
            document.getElementById('inputNumeroSerie').addEventListener('input', actualizarResumen);
            document.getElementById('inputPlacas').addEventListener('input', actualizarResumen);

            // Formulario de alta
            document.getElementById('formAltaVehiculo').addEventListener('submit', function(e) {
                e.preventDefault();
                registrarVehiculo();
            });
        }

        // Actualizar información del cliente seleccionado
        function actualizarInfoCliente(clienteId) {
            const infoDiv = document.getElementById('infoCliente');
            
            if (!clienteId) {
                infoDiv.classList.add('hidden');
                return;
            }

            const cliente = clientes[clienteId];
            if (cliente) {
                document.getElementById('clienteNombre').textContent = cliente.nombre;
                document.getElementById('clienteTelefono').textContent = cliente.telefono;
                document.getElementById('clienteEmail').textContent = cliente.email;
                document.getElementById('clienteVehiculos').textContent = cliente.vehiculos + ' vehículo(s)';
                infoDiv.classList.remove('hidden');
            }
        }

        // Cargar modelos según la marca seleccionada
        function cargarModelos(marcaId) {
            const selectModelo = document.getElementById('selectModelo');
            selectModelo.innerHTML = '<option value="">Selecciona un modelo</option>';

            if (marcaId && modelosPorMarca[marcaId]) {
                modelosPorMarca[marcaId].forEach(modelo => {
                    const option = document.createElement('option');
                    option.value = modelo;
                    option.textContent = modelo;
                    selectModelo.appendChild(option);
                });
            }
        }

        // Actualizar resumen en tiempo real
        function actualizarResumen() {
            const clienteSelect = document.getElementById('selectCliente');
            const clienteId = clienteSelect.value;
            const clienteNombre = clienteSelect.options[clienteSelect.selectedIndex]?.text.split(' - ')[0] || '-';
            
            const marcaSelect = document.getElementById('selectMarca');
            const marca = marcaSelect.options[marcaSelect.selectedIndex]?.text || '-';
            
            const modeloSelect = document.getElementById('selectModelo');
            const modelo = modeloSelect.options[modeloSelect.selectedIndex]?.text || '-';
            
            const anio = document.getElementById('inputAnio').value || '-';
            const color = document.getElementById('inputColor').value || '-';
            const kilometraje = document.getElementById('inputKilometraje').value || '-';
            const placas = document.getElementById('inputPlacas').value || '-';

            document.getElementById('resumenCliente').textContent = clienteNombre;
            document.getElementById('resumenVehiculo').textContent = `${marca} ${modelo}`;
            document.getElementById('resumenAnio').textContent = anio;
            document.getElementById('resumenColor').textContent = color;
            document.getElementById('resumenPlacas').textContent = placas;
            document.getElementById('resumenKilometraje').textContent = kilometraje !== '-' ? kilometraje + ' km' : '-';
        }

        // Validar formulario
        function validarFormulario() {
            const cliente = document.getElementById('selectCliente').value;
            const marca = document.getElementById('selectMarca').value;
            const modelo = document.getElementById('selectModelo').value;
            const anio = document.getElementById('inputAnio').value;
            const color = document.getElementById('inputColor').value;
            const kilometraje = document.getElementById('inputKilometraje').value;
            const numeroSerie = document.getElementById('inputNumeroSerie').value;
            const placas = document.getElementById('inputPlacas').value;

            if (!cliente) {
                alert('Por favor selecciona un cliente');
                return false;
            }

            if (!marca) {
                alert('Por favor selecciona una marca');
                return false;
            }

            if (!modelo) {
                alert('Por favor selecciona un modelo');
                return false;
            }

            if (!anio) {
                alert('Por favor ingresa el año del vehículo');
                return false;
            }

            if (anio < 1990 || anio > 2024) {
                alert('Por favor ingresa un año válido (1990-2024)');
                return false;
            }

            if (!color) {
                alert('Por favor ingresa el color del vehículo');
                return false;
            }

            if (!kilometraje) {
                alert('Por favor ingresa el kilometraje actual');
                return false;
            }

            if (kilometraje < 0) {
                alert('El kilometraje no puede ser negativo');
                return false;
            }

            if (!numeroSerie) {
                alert('Por favor ingresa el número de serie (VIN)');
                return false;
            }

            if (!placas) {
                alert('Por favor ingresa las placas del vehículo');
                return false;
            }

            return true;
        }

        // Registrar vehículo
        function registrarVehiculo() {
            if (!validarFormulario()) {
                return;
            }

            // Obtener datos del formulario
            const vehiculoData = {
                id_cliente: document.getElementById('selectCliente').value,
                id_marca: document.getElementById('selectMarca').value,
                id_modelo: document.getElementById('selectModelo').value,
                anio: document.getElementById('inputAnio').value,
                color: document.getElementById('inputColor').value,
                kilometraje: document.getElementById('inputKilometraje').value,
                numero_serie: document.getElementById('inputNumeroSerie').value,
                placas: document.getElementById('inputPlacas').value,
                // Información para mostrar en confirmación
                cliente_nombre: document.getElementById('selectCliente').options[document.getElementById('selectCliente').selectedIndex].text.split(' - ')[0],
                marca_nombre: document.getElementById('selectMarca').options[document.getElementById('selectMarca').selectedIndex].text,
                modelo_nombre: document.getElementById('selectModelo').options[document.getElementById('selectModelo').selectedIndex].text
            };

            // En una implementación real, aquí enviarías los datos al servidor
            console.log('Datos del vehículo:', vehiculoData);

            // Simular éxito de registro
            mostrarModalConfirmacion(vehiculoData);
        }

        // Mostrar modal de confirmación
        function mostrarModalConfirmacion(vehiculoData) {
            document.getElementById('confirmacionCliente').textContent = vehiculoData.cliente_nombre;
            document.getElementById('confirmacionVehiculo').textContent = `${vehiculoData.marca_nombre} ${vehiculoData.modelo_nombre} ${vehiculoData.anio}`;
            document.getElementById('confirmacionPlacas').textContent = vehiculoData.placas;
            document.getElementById('confirmacionSerie').textContent = vehiculoData.numero_serie;
            
            document.getElementById('modalConfirmacion').classList.remove('hidden');
        }

        // Cerrar modal de confirmación
        function cerrarModalConfirmacion() {
            document.getElementById('modalConfirmacion').classList.add('hidden');
            
            // Limpiar formulario
            document.getElementById('formAltaVehiculo').reset();
            document.getElementById('infoCliente').classList.add('hidden');
            actualizarResumen();
        }

        // Cerrar modal con ESC
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                cerrarModalConfirmacion();
            }
        });
    </script>
</body>

</html>